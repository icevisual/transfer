<!DOCTYPE html>
<html>
<head>
<title>mqtt test</title>
</head>
<body>
	<script type="text/javascript" src="OpenSDK/date.prototype.ext.js"></script>
	<script type="text/javascript" src="OpenSDK/mqttws31.js"></script>
	<script type="text/javascript">
    
    var mqttConfig = {
   	    'hostname': '120.26.109.169',
   	    'port': '8083',
   	};
   	var clientId = parseInt(Math.random() * 100000000);
   	clientId = 'testSimpleMqttTest';
   	// Create a client instance
   	client = new Paho.MQTT.Client(mqttConfig.hostname, Number(mqttConfig.port), clientId + "");

   	// set callback handlers
   	client.onConnectionLost = onConnectionLost;
   	client.onMessageArrived = onMessageArrived;
   	client.onMessageDelivered = onMessageDelivered;

   	// connect the client
   	client.connect({
   	    onSuccess: onConnect,
	   	userName : 'testSimpleMqttTest',
	    password : 'testSimpleMqttTest',
   	});

   	function log() {
   	    for (var i in arguments) {
   	        console.log("[" + now() + "] " + arguments[i]);
   	    }
   	}
   	
   	function onMessageDelivered(message){
   		log("onMessageDelivered,destinationName = " 
                + message.destinationName, message.payloadBytes);
   	}

   	// called when the client connects
   	function onConnect() {
   	    // Once a connection has been made, make a subscription and send a message.
		var topic = "/TCeOp0gzzrWhAMoOa3Mm";
		var respTopic = "/TCeOp0gzzrWhAMoOa3Mm/resp";
// 		respTopic = topic;
		log("onConnect,clientId = " + topic);
		client.subscribe(respTopic,{
            qos : 2,
            invocationContext : {'topic':respTopic},
            onSuccess : function(obj){
				log('subscribe onSuccess ' + obj.invocationContext.topic);
				message = new Paho.MQTT.Message(new Uint8Array([254, 1, 0, 0, 0, 1, 87, 234, 149, 229]));
				message.destinationName = topic;
				client.send(message);
            },
            onFailure : function(){
            	log('subscribe onFailure ' + obj.invocationContext.topic);
            }
        });
   	    log("onConnect,subscribe " + respTopic);
   	}

   	// called when the client loses its connection
   	function onConnectionLost(responseObject) {
   	    if (responseObject.errorCode !== 0) {
   	        log("onConnectionLost:" + responseObject.errorMessage);
   	    }
   	}

   	var arriveMsg;

   	// called when a message arrives
   	function onMessageArrived(message) {
   	    log("onMessageArrived payloadBytes:", message.payloadBytes);
   	}

   	function sendMessage() {
   	    var data = ['', '/' + clientId];
   	    for (var i in arguments) {
   	        data[i] = arguments[i];
   	    }
   	    message = new Paho.MQTT.Message(data[0]);
   	    message.destinationName = data[1] + "";
   	    client.send(message);
   	    log(data[0] + " ==> " + data[1]);
   	    return;
   	}

   	function subscribe() {
   	    client.subscribe("/word");
   	}


    
    
    </script>

</body>
</html>