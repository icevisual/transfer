/*******************************************************************************
 * Copyright (c) 2013 IBM Corp.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * and Eclipse Distribution License v1.0 which accompany this distribution. 
 *
 * The Eclipse Public License is available at 
 *    http://www.eclipse.org/legal/epl-v10.html
 * and the Eclipse Distribution License is available at 
 *   http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * Contributors:
 *    Andrew Banks - initial API and implementation and initial documentation
 *******************************************************************************/

/*
 long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/long.js for details
*/

/*
 bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 Backing buffer: ArrayBuffer, Accessor: Uint8Array
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/bytebuffer.js for details
*/

/*
 protobuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/protobuf.js for details
*/

function n(e,t){var i,r,n,s,o,a,f,h=t.slice(0),l=e.d;for(n=l[0],s=l[1],o=l[2],a=l[3],f=l[4],i=0;79>=i;i++)16<=i&&(h[i]=(h[i-3]^h[i-8]^h[i-14]^h[i-16])<<1|(h[i-3]^h[i-8]^h[i-14]^h[i-16])>>>31),r=19>=i?s&o|~s&a:39>=i?s^o^a:59>=i?s&o|s&a|o&a:79>=i?s^o^a:void 0,r=(n<<5|n>>>27)+r+f+h[i]+e.i[Math.floor(i/20)]|0,f=a,a=o,o=s<<30|s>>>2,s=n,n=r;l[0]=l[0]+n|0,l[1]=l[1]+s|0,l[2]=l[2]+o|0,l[3]=l[3]+a|0,l[4]=l[4]+f|0}"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(e){function t(e,t){var i=t,r=e[t],s=r>>4,o=r&=15;t+=1;var a,h=0,u=1;do{if(t==e.length)return[null,i];a=e[t++],h+=(127&a)*u,u*=128}while(0!=(128&a));var c=t+h;if(c>e.length)return[null,i];var d=new v(s);switch(s){case l.CONNACK:var p=e[t++];1&p&&(d.sessionPresent=!0),d.returnCode=e[t++];break;case l.PUBLISH:var g=o>>1&3,E=n(e,t);t+=2;var y=f(e,t,E);t+=E,g>0&&(d.messageIdentifier=n(e,t),t+=2);var m=new Paho.MQTT.Message(e.subarray(t,c));1==(1&o)&&(m.retained=!0),8==(8&o)&&(m.duplicate=!0),m.qos=g,m.destinationName=y,d.payloadMessage=m;break;case l.PUBACK:case l.PUBREC:case l.PUBREL:case l.PUBCOMP:case l.UNSUBACK:d.messageIdentifier=n(e,t);break;case l.SUBACK:d.messageIdentifier=n(e,t),t+=2,d.returnCode=e.subarray(t,c)}return[d,c]}function i(e,t,i){return t[i++]=e>>8,t[i++]=e%256,i}function r(e,t,r,n){return n=i(t,r,n),a(e,r,n),n+t}function n(e,t){return 256*e[t]+e[t+1]}function s(e){var t=new Array(1),i=0;do{var r=e%128;e>>=7,e>0&&(r|=128),t[i++]=r}while(e>0&&i<4);return t}function o(e){for(var t=0,i=0;i<e.length;i++){var r=e.charCodeAt(i);r>2047?(55296<=r&&r<=56319&&(i++,t++),t+=3):r>127?t+=2:t++}return t}function a(e,t,i){for(var r=i,n=0;n<e.length;n++){var s=e.charCodeAt(n);if(55296<=s&&s<=56319){var o=e.charCodeAt(++n);if(isNaN(o))throw new Error(g(d.MALFORMED_UNICODE,[s,o]));s=(s-55296<<10)+(o-56320)+65536}s<=127?t[r++]=s:s<=2047?(t[r++]=s>>6&31|192,t[r++]=63&s|128):s<=65535?(t[r++]=s>>12&15|224,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>18&7|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t}function f(e,t,i){for(var r,n="",s=t;s<t+i;){var o=e[s++];if(o<128)r=o;else{var a=e[s++]-128;if(a<0)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),""]));if(o<224)r=64*(o-192)+a;else{var f=e[s++]-128;if(f<0)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),f.toString(16)]));if(o<240)r=4096*(o-224)+64*a+f;else{var h=e[s++]-128;if(h<0)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),f.toString(16),h.toString(16)]));if(!(o<248))throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),f.toString(16),h.toString(16)]));r=262144*(o-240)+4096*a+64*f+h}}}r>65535&&(r-=65536,n+=String.fromCharCode(55296+(r>>10)),r=56320+(1023&r)),n+=String.fromCharCode(r)}return n}var h="@VERSION@",l={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},u=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i)){var r="Unknown property, "+i+". Valid properties are:";for(var i in t)t.hasOwnProperty(i)&&(r=r+" "+i);throw new Error(r)}if(typeof e[i]!==t[i])throw new Error(g(d.INVALID_TYPE,[typeof e[i],i]))}},c=function(e,t){return function(){return e.apply(t,arguments)}},d={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},p={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},g=function(e,t){var i=e.text;if(t)for(var r,n,s=0;s<t.length;s++)if(r="{"+s+"}",n=i.indexOf(r),n>0){var o=i.substring(0,n),a=i.substring(n+r.length);i=o+t[s]+a}return i},E=[0,6,77,81,73,115,100,112,3],y=[0,4,77,81,84,84,4],v=function(e,t){this.type=e;for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};v.prototype.encode=function(){var e=(15&this.type)<<4,t=0,n=new Array,a=0;switch(void 0!=this.messageIdentifier&&(t+=2),this.type){case l.CONNECT:switch(this.mqttVersion){case 3:t+=E.length+3;break;case 4:t+=y.length+3}if(t+=o(this.clientId)+2,void 0!=this.willMessage){t+=o(this.willMessage.destinationName)+2;var f=this.willMessage.payloadBytes;f instanceof Uint8Array||(f=new Uint8Array(u)),t+=f.byteLength+2}void 0!=this.userName&&(t+=o(this.userName)+2),void 0!=this.password&&(t+=o(this.password)+2);break;case l.SUBSCRIBE:e|=2;for(var h=0;h<this.topics.length;h++)n[h]=o(this.topics[h]),t+=n[h]+2;t+=this.requestedQos.length;break;case l.UNSUBSCRIBE:e|=2;for(var h=0;h<this.topics.length;h++)n[h]=o(this.topics[h]),t+=n[h]+2;break;case l.PUBREL:e|=2;break;case l.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),a=o(this.payloadMessage.destinationName),t+=a+2;var u=this.payloadMessage.payloadBytes;t+=u.byteLength,u instanceof ArrayBuffer?u=new Uint8Array(u):u instanceof Uint8Array||(u=new Uint8Array(u.buffer));break;case l.DISCONNECT:}var c=s(t),d=c.length+1,p=new ArrayBuffer(t+d),g=new Uint8Array(p);if(g[0]=e,g.set(c,1),this.type==l.PUBLISH)d=r(this.payloadMessage.destinationName,a,g,d);else if(this.type==l.CONNECT){switch(this.mqttVersion){case 3:g.set(E,d),d+=E.length;break;case 4:g.set(y,d),d+=y.length}var v=0;this.cleanSession&&(v=2),void 0!=this.willMessage&&(v|=4,v|=this.willMessage.qos<<3,this.willMessage.retained&&(v|=32)),void 0!=this.userName&&(v|=128),void 0!=this.password&&(v|=64),g[d++]=v,d=i(this.keepAliveInterval,g,d)}switch(void 0!=this.messageIdentifier&&(d=i(this.messageIdentifier,g,d)),this.type){case l.CONNECT:d=r(this.clientId,o(this.clientId),g,d),void 0!=this.willMessage&&(d=r(this.willMessage.destinationName,o(this.willMessage.destinationName),g,d),d=i(f.byteLength,g,d),g.set(f,d),d+=f.byteLength),void 0!=this.userName&&(d=r(this.userName,o(this.userName),g,d)),void 0!=this.password&&(d=r(this.password,o(this.password),g,d));break;case l.PUBLISH:g.set(u,d);break;case l.SUBSCRIBE:for(var h=0;h<this.topics.length;h++)d=r(this.topics[h],n[h],g,d),g[d++]=this.requestedQos[h];break;case l.UNSUBSCRIBE:for(var h=0;h<this.topics.length;h++)d=r(this.topics[h],n[h],g,d)}return p};var m=function(e,t,i){this._client=e,this._window=t,this._keepAliveInterval=1e3*i,this.isReset=!1;var r=new v(l.PINGREQ).encode(),n=function(e){return function(){return s.apply(e)}},s=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(r),this.timeout=this._window.setTimeout(n(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(d.PING_TIMEOUT.code,g(d.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(n(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},S=function(e,t,i,r,n){this._window=t,i||(i=30);var s=function(e,t,i){return function(){return e.apply(t,i)}};this.timeout=setTimeout(s(r,e,n),1e3*i),this.cancel=function(){this._window.clearTimeout(this.timeout)}},w=function(t,i,r,n,s){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(g(d.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw new Error(g(d.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(g(d.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",t,i,r,n,s),this.host=i,this.port=r,this.path=n,this.uri=t,this.clientId=s,this._localKey=i+":"+r+("/mqtt"!=n?":"+n:"")+":"+s+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var o in localStorage)0!=o.indexOf("Sent:"+this._localKey)&&0!=o.indexOf("Received:"+this._localKey)||this.restore(o)};w.prototype.host,w.prototype.port,w.prototype.path,w.prototype.uri,w.prototype.clientId,w.prototype.socket,w.prototype.connected=!1,w.prototype.maxMessageIdentifier=65536,w.prototype.connectOptions,w.prototype.hostIndex,w.prototype.onConnectionLost,w.prototype.onMessageDelivered,w.prototype.onMessageArrived,w.prototype.traceFunction,w.prototype._msg_queue=null,w.prototype._connectTimeout,w.prototype.sendPinger=null,w.prototype.receivePinger=null,w.prototype.receiveBuffer=null,w.prototype._traceBuffer=null,w.prototype._MAX_TRACE_ENTRIES=100,w.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(g(d.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(g(d.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},w.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));var i=new v(l.SUBSCRIBE);i.topics=[e],void 0!=t.qos?i.requestedQos=[t.qos]:i.requestedQos=[0],t.onSuccess&&(i.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(i.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(i.timeOut=new S(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:d.SUBSCRIBE_TIMEOUT.code,errorMessage:g(d.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},w.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));var i=new v(l.UNSUBSCRIBE);i.topics=[e],t.onSuccess&&(i.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(i.timeOut=new S(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:d.UNSUBSCRIBE_TIMEOUT.code,errorMessage:g(d.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},w.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));wireMessage=new v(l.PUBLISH),wireMessage.payloadMessage=e,e.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},w.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(g(d.INVALID_STATE,["not connecting or connected"]));wireMessage=new v(l.DISCONNECT),this._notify_msg_sent[wireMessage]=c(this._disconnected,this),this._schedule_message(wireMessage)},w.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},w.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,h)},w.prototype.stopTrace=function(){delete this._traceBuffer},w.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=c(this._on_socket_open,this),this.socket.onmessage=c(this._on_socket_message,this),this.socket.onerror=c(this._on_socket_error,this),this.socket.onclose=c(this._on_socket_close,this),this.sendPinger=new m(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new m(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new S(this,window,this.connectOptions.timeout,this._disconnected,[d.CONNECT_TIMEOUT.code,g(d.CONNECT_TIMEOUT)])},w.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},w.prototype.store=function(e,t){var i={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case l.PUBLISH:t.pubRecReceived&&(i.pubRecReceived=!0),i.payloadMessage={};for(var r="",n=t.payloadMessage.payloadBytes,s=0;s<n.length;s++)n[s]<=15?r=r+"0"+n[s].toString(16):r+=n[s].toString(16);i.payloadMessage.payloadHex=r,i.payloadMessage.qos=t.payloadMessage.qos,i.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(i.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(i.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),i.sequence=t.sequence);break;default:throw Error(g(d.INVALID_STORED_DATA,[key,i]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(i))},w.prototype.restore=function(e){var t=localStorage.getItem(e),i=JSON.parse(t),r=new v(i.type,i);switch(i.type){case l.PUBLISH:for(var n=i.payloadMessage.payloadHex,s=new ArrayBuffer(n.length/2),o=new Uint8Array(s),a=0;n.length>=2;){var f=parseInt(n.substring(0,2),16);n=n.substring(2,n.length),o[a++]=f}var h=new Paho.MQTT.Message(o);h.qos=i.payloadMessage.qos,h.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(h.duplicate=!0),i.payloadMessage.retained&&(h.retained=!0),r.payloadMessage=h;break;default:throw Error(g(d.INVALID_STORED_DATA,[e,t]))}0==e.indexOf("Sent:"+this._localKey)?(r.payloadMessage.duplicate=!0,this._sentMessages[r.messageIdentifier]=r):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[r.messageIdentifier]=r)},w.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},w.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===l.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},w.prototype._on_socket_open=function(){var e=new v(l.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},w.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data);for(var t=this._deframeMessages(e.data),i=0;i<t.length;i+=1)this._handleMessage(t[i])},w.prototype._deframeMessages=function(e){var i=new Uint8Array(e);if(this.receiveBuffer){var r=new Uint8Array(this.receiveBuffer.length+i.length);r.set(this.receiveBuffer),r.set(i,this.receiveBuffer.length),i=r,delete this.receiveBuffer}try{for(var n=0,s=[];n<i.length;){var o=t(i,n),a=o[0];if(n=o[1],null===a)break;s.push(a)}n<i.length&&(this.receiveBuffer=i.subarray(n))}catch(e){return void this._disconnected(d.INTERNAL_ERROR.code,g(d.INTERNAL_ERROR,[e.message,e.stack.toString()]))}return s},w.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case l.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var i=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+i.messageIdentifier)}this._sentMessages={};for(var t in this._receivedMessages){var r=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+r.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(d.CONNACK_RETURNCODE.code,g(d.CONNACK_RETURNCODE,[e.returnCode,p[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var n=new Array;for(var s in this._sentMessages)this._sentMessages.hasOwnProperty(s)&&n.push(this._sentMessages[s]);for(var n=n.sort(function(e,t){return e.sequence-t.sequence}),o=0,a=n.length;o<a;o++){var i=n[o];if(i.type==l.PUBLISH&&i.pubRecReceived){var f=new v(l.PUBREL,{messageIdentifier:i.messageIdentifier});this._schedule_message(f)}else this._schedule_message(i)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case l.PUBLISH:this._receivePublish(e);break;case l.PUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage));break;case l.PUBREC:var i=this._sentMessages[e.messageIdentifier];if(i){i.pubRecReceived=!0;var f=new v(l.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",i),this._schedule_message(f)}break;case l.PUBREL:var r=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),r&&(this._receiveMessage(r),delete this._receivedMessages[e.messageIdentifier]);var h=new v(l.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(h);break;case l.PUBCOMP:var i=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage);break;case l.SUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),128===e.returnCode[0]?i.onFailure&&i.onFailure(e.returnCode):i.onSuccess&&i.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case l.UNSUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),i.callback&&i.callback(),delete this._sentMessages[e.messageIdentifier]);break;case l.PINGRESP:this.sendPinger.reset();break;case l.DISCONNECT:this._disconnected(d.INVALID_MQTT_MESSAGE_TYPE.code,g(d.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(d.INVALID_MQTT_MESSAGE_TYPE.code,g(d.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){return void this._disconnected(d.INTERNAL_ERROR.code,g(d.INTERNAL_ERROR,[e.message,e.stack.toString()]))}},w.prototype._on_socket_error=function(e){this._disconnected(d.SOCKET_ERROR.code,g(d.SOCKET_ERROR,[e.data]))},w.prototype._on_socket_close=function(){this._disconnected(d.SOCKET_CLOSE.code,g(d.SOCKET_CLOSE))},w.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},w.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new v(l.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var i=new v(l.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(i);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},w.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},w.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=d.OK.code,t=g(d.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},w.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)"undefined"!=typeof arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,i=arguments.length;e<i;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e?this._traceBuffer.push(arguments[e]):"undefined"==typeof arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))},w.prototype._traceMask=function(e,t){var i={};for(var r in e)e.hasOwnProperty(r)&&(r==t?i[r]="******":i[r]=e[r]);return i};var b=function(e,t,i,r){var n;if("string"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"host"]));if(2==arguments.length){r=t,n=e;var s=n.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!s)throw new Error(g(d.INVALID_ARGUMENT,[e,"host"]));e=s[4]||s[2],t=parseInt(s[7]),i=s[8]}else{if(3==arguments.length&&(r=i,i="/mqtt"),"number"!=typeof t||t<0)throw new Error(g(d.INVALID_TYPE,[typeof t,"port"]));if("string"!=typeof i)throw new Error(g(d.INVALID_TYPE,[typeof i,"path"]));var o=e.indexOf(":")!=-1&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);n="ws://"+(o?"["+e+"]":e)+":"+t+i}for(var a=0,f=0;f<r.length;f++){var h=r.charCodeAt(f);55296<=h&&h<=56319&&f++,a++}if("string"!=typeof r||a>65535)throw new Error(g(d.INVALID_ARGUMENT,[r,"clientId"]));var l=new w(n,e,t,i,r);this._getHost=function(){return e},this._setHost=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getPath=function(){return i},this._setPath=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getURI=function(){return n},this._setURI=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getClientId=function(){return l.clientId},this._setClientId=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return l.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onConnectionLost"]));l.onConnectionLost=e},this._getOnMessageDelivered=function(){return l.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onMessageDelivered"]));l.onMessageDelivered=e},this._getOnMessageArrived=function(){return l.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onMessageArrived"]));l.onMessageArrived=e},this._getTrace=function(){return l.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onTrace"]));l.traceFunction=e},this.connect=function(e){if(e=e||{},u(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(g(d.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0!==e.password&&void 0===e.userName)throw new Error(g(d.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof T))throw new Error(g(d.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,"undefined"==typeof e.willMessage.destinationName)throw new Error(g(d.INVALID_TYPE,[typeof e.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if("undefined"==typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(g(d.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,r=0;r<e.hosts.length;r++){if("string"!=typeof e.hosts[r])throw new Error(g(d.INVALID_TYPE,[typeof e.hosts[r],"connectOptions.hosts["+r+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[r])){if(0==r)t=!0;else if(!t)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts[r],"connectOptions.hosts["+r+"]"]))}else if(t)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts[r],"connectOptions.hosts["+r+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(var r=0;r<e.hosts.length;r++){if("number"!=typeof e.ports[r]||e.ports[r]<0)throw new Error(g(d.INVALID_TYPE,[typeof e.ports[r],"connectOptions.ports["+r+"]"]));var s=e.hosts[r],o=e.ports[r],a=s.indexOf(":")!=-1;n="ws://"+(a?"["+s+"]":s)+":"+o+i,e.uris.push(n)}}}l.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},u(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!=typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(g(d.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));l.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},u(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");l.unsubscribe(e,t)},this.send=function(e,t,i,r){var n;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof T)&&"string"!=typeof e)throw new Error("Invalid argument:"+typeof e);if(n=e,"undefined"==typeof n.destinationName)throw new Error(g(d.INVALID_ARGUMENT,[n.destinationName,"Message.destinationName"]));l.send(n)}else n=new T(t),n.destinationName=e,arguments.length>=3&&(n.qos=i),arguments.length>=4&&(n.retained=r),l.send(n)},this.disconnect=function(){l.disconnect()},this.getTraceLog=function(){return l.getTraceLog()},this.startTrace=function(){l.startTrace()},this.stopTrace=function(){l.stopTrace()},this.isConnected=function(){return l.connected}};b.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var T=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw g(d.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:f(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(o(t)),i=new Uint8Array(e);return a(t,i,0),i}return t};var i=void 0;this._getDestinationName=function(){return i},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(g(d.INVALID_ARGUMENT,[e,"newDestinationName"]));i=e};var r=0;this._getQos=function(){return r},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);r=e};var n=!1;this._getRetained=function(){return n},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(g(d.INVALID_ARGUMENT,[e,"newRetained"]));n=e};var s=!1;this._getDuplicate=function(){return s},this._setDuplicate=function(e){s=e}};return T.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:b,Message:T}}(window),define("Paho",function(e){return function(){var t;return t||e.Paho}}(this)),function(e,t){"function"==typeof define&&define.amd?define("long",[],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}function i(e,t){var i,r;if(t){if(e>>>=0,(r=0<=e&&256>e)&&(i=f[e]))return i;i=n(e,0>(0|e)?-1:0,!0),r&&(f[e]=i)}else{if(e|=0,(r=-128<=e&&128>e)&&(i=a[e]))return i;i=n(e,0>e?-1:0,!1),r&&(a[e]=i)}return i}function r(e,t){if(isNaN(e)||!isFinite(e))return t?p:d;if(t){if(0>e)return p;if(e>=l)return m}else{if(e<=-u)return S;if(e+1>=u)return v}return 0>e?r(-e,t).neg():n(e%4294967296|0,e/4294967296|0,t)}function n(t,i,r){return new e(t,i,r)}function s(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return d;if("number"==typeof t?(i=t,t=!1):t=!!t,i=i||10,2>i||36<i)throw RangeError("radix");var n;if(0<(n=e.indexOf("-")))throw Error("interior hyphen");if(0===n)return s(e.substring(1),t,i).neg();n=r(h(i,8));for(var o=d,a=0;a<e.length;a+=8){var f=Math.min(8,e.length-a),l=parseInt(e.substring(a,a+f),i);8>f?(f=r(h(i,f)),o=o.mul(f).add(r(l))):(o=o.mul(n),o=o.add(r(l)))}return o.unsigned=t,o}function o(t){return t instanceof e?t:"number"==typeof t?r(t):"string"==typeof t?s(t):n(t.low,t.high,t.unsigned);
}Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var a={},f={};e.fromInt=i,e.fromNumber=r,e.fromBits=n;var h=Math.pow;e.fromString=s,e.fromValue=o;var l=0x10000000000000000,u=l/2,c=i(16777216),d=i(0);e.ZERO=d;var p=i(0,!0);e.UZERO=p;var g=i(1);e.ONE=g;var E=i(1,!0);e.UONE=E;var y=i(-1);e.NEG_ONE=y;var v=n(-1,2147483647,!1);e.MAX_VALUE=v;var m=n(-1,-1,!0);e.MAX_UNSIGNED_VALUE=m;var S=n(0,-2147483648,!1);e.MIN_VALUE=S;var w=e.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?4294967296*(this.high>>>0)+(this.low>>>0):4294967296*this.high+(this.low>>>0)},w.toString=function(e){if(e=e||10,2>e||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=r(e),i=this.div(t),t=i.mul(t).sub(this);return i.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=r(h(e,6),this.unsigned),t=this,n="";;){var s=t.div(i),o=(t.sub(s.mul(i)).toInt()>>>0).toString(e),t=s;if(t.isZero())return o+n;for(;6>o.length;)o="0"+o;n=""+o+n}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&0>this.high},w.isPositive=function(){return this.unsigned||0<=this.high},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(e){return t(e)||(e=o(e)),(this.unsigned===e.unsigned||1!==this.high>>>31||1!==e.high>>>31)&&(this.high===e.high&&this.low===e.low)},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.lessThan=function(e){return 0>this.comp(e)},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return 0>=this.comp(e)},w.lte=w.lessThanOrEqual,w.greaterThan=function(e){return 0<this.comp(e)},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return 0<=this.comp(e)},w.gte=w.greaterThanOrEqual,w.compare=function(e){if(t(e)||(e=o(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(g)},w.neg=w.negate,w.add=function(e){t(e)||(e=o(e));var i,r=this.high>>>16,s=65535&this.high,a=this.low>>>16,f=e.high>>>16,h=65535&e.high,l=e.low>>>16;return i=0+((65535&this.low)+(65535&e.low)),e=0+(i>>>16),e+=a+l,a=0+(e>>>16),a+=s+h,s=0+(a>>>16),s=s+(r+f)&65535,n((65535&e)<<16|65535&i,s<<16|65535&a,this.unsigned)},w.subtract=function(e){return t(e)||(e=o(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return d;if(t(e)||(e=o(e)),e.isZero())return d;if(this.eq(S))return e.isOdd()?S:d;if(e.eq(S))return this.isOdd()?S:d;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(c)&&e.lt(c))return r(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,s=65535&this.high,a=this.low>>>16,f=65535&this.low,h=e.high>>>16,l=65535&e.high,u=e.low>>>16;e=65535&e.low;var p,g,E,y;return y=0+f*e,E=0+(y>>>16),E+=a*e,g=0+(E>>>16),E=(65535&E)+f*u,g+=E>>>16,E&=65535,g+=s*e,p=0+(g>>>16),g=(65535&g)+a*u,p+=g>>>16,g&=65535,g+=f*l,p+=g>>>16,g&=65535,p=p+(i*e+s*u+a*l+f*h)&65535,n(E<<16|65535&y,p<<16|g,this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(t(e)||(e=o(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:d;var i,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return p;if(e.gt(this.shru(1)))return E;s=p}else{if(this.eq(S))return e.eq(g)||e.eq(y)?S:e.eq(S)?g:(i=this.shr(1).div(e).shl(1),i.eq(d)?e.isNegative()?g:y:(n=this.sub(e.mul(i)),s=i.add(n.div(e))));if(e.eq(S))return this.unsigned?p:d;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=d}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),a=48>=a?1:h(2,a-48),f=r(i),l=f.mul(e);l.isNegative()||l.gt(n);)i-=a,f=r(i,this.unsigned),l=f.mul(e);f.isZero()&&(f=g),s=s.add(f),n=n.sub(l)}return s},w.div=w.divide,w.modulo=function(e){return t(e)||(e=o(e)),this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.not=function(){return n(~this.low,~this.high,this.unsigned)},w.and=function(e){return t(e)||(e=o(e)),n(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return t(e)||(e=o(e)),n(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return t(e)||(e=o(e)),n(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:32>e?n(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):n(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:32>e?n(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):n(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),e&=63,0===e)return this;var i=this.high;return 32>e?n(this.low>>>e|i<<32-e,i>>>e,this.unsigned):32===e?n(i,0,this.unsigned):n(i>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?n(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:n(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e}),function(e,t){if("function"==typeof define&&define.amd)define("bytebuffer",["long"],t);else if("function"==typeof require&&"object"==typeof module&&module&&module.exports){var i,r=module;try{i=require("long")}catch(e){}i=t(i),r.exports=i}else(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(e){function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function i(){var e=[],t=[];return function(){return 0===arguments.length?t.join("")+f.apply(String,e):(1024<e.length+arguments.length&&(t.push(f.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}}function r(e,t,i,r,n){var s;s=8*n-r-1;var o=(1<<s)-1,a=o>>1,f=-7;n=i?n-1:0;var h=i?-1:1,l=e[t+n];for(n+=h,i=l&(1<<-f)-1,l>>=-f,f+=s;0<f;i=256*i+e[t+n],n+=h,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;0<f;s=256*s+e[t+n],n+=h,f-=8);if(0===i)i=1-a;else{if(i===o)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,r),i-=a}return(l?-1:1)*s*Math.pow(2,i-r)}function n(e,t,i,r,n,s){var o,a=8*s-n-1,f=(1<<a)-1,h=f>>1,l=23===n?Math.pow(2,-24)-Math.pow(2,-77):0;s=r?0:s-1;var u=r?1:-1,c=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(t=isNaN(t)?1:0,r=f):(r=Math.floor(Math.log(t)/Math.LN2),1>t*(o=Math.pow(2,-r))&&(r--,o*=2),t=1<=r+h?t+l/o:t+l*Math.pow(2,1-h),2<=t*o&&(r++,o/=2),r+h>=f?(t=0,r=f):1<=r+h?(t=(t*o-1)*Math.pow(2,n),r+=h):(t=t*Math.pow(2,h-1)*Math.pow(2,n),r=0));8<=n;e[i+s]=255&t,s+=u,t/=256,n-=8);for(r=r<<n|t,a+=n;0<a;e[i+s]=255&r,s+=u,r/=256,a-=8);e[i+s-u]|=128*c}var s=function(e,t,i){if("undefined"==typeof e&&(e=s.DEFAULT_CAPACITY),"undefined"==typeof t&&(t=s.DEFAULT_ENDIAN),"undefined"==typeof i&&(i=s.DEFAULT_NOASSERT),!i){if(e|=0,0>e)throw RangeError("Illegal capacity");t=!!t,i=!!i}this.buffer=0===e?a:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=i};s.VERSION="5.0.1",s.LITTLE_ENDIAN=!0,s.BIG_ENDIAN=!1,s.DEFAULT_CAPACITY=16,s.DEFAULT_ENDIAN=s.BIG_ENDIAN,s.DEFAULT_NOASSERT=!1,s.Long=e||null;var o=s.prototype;Object.defineProperty(o,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var a=new ArrayBuffer(0),f=String.fromCharCode;s.accessor=function(){return Uint8Array},s.allocate=function(e,t,i){return new s(e,t,i)},s.concat=function(e,t,i,r){"boolean"!=typeof t&&"string"==typeof t||(r=i,i=t,t=void 0);for(var n,o=0,a=0,f=e.length;a<f;++a)s.isByteBuffer(e[a])||(e[a]=s.wrap(e[a],t)),n=e[a].limit-e[a].offset,0<n&&(o+=n);if(0===o)return new s(0,i,r);for(t=new s(o,i,r),a=0;a<f;)i=e[a++],n=i.limit-i.offset,0>=n||(t.view.set(i.view.subarray(i.offset,i.limit),t.offset),t.offset+=n);return t.limit=t.offset,t.offset=0,t},s.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},s.type=function(){return ArrayBuffer},s.wrap=function(e,t,i,r){if("string"!=typeof t&&(r=i,i=t,t=void 0),"string"==typeof e)switch("undefined"==typeof t&&(t="utf8"),t){case"base64":return s.fromBase64(e,i);case"hex":return s.fromHex(e,i);case"binary":return s.fromBinary(e,i);case"utf8":return s.fromUTF8(e,i);case"debug":return s.fromDebug(e,i);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");if(s.isByteBuffer(e))return t=o.clone.call(e),t.markedOffset=-1,t;if(e instanceof Uint8Array)t=new s(0,i,r),0<e.length&&(t.buffer=e.buffer,t.offset=e.byteOffset,t.limit=e.byteOffset+e.byteLength,t.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)t=new s(0,i,r),0<e.byteLength&&(t.buffer=e,t.offset=0,t.limit=e.byteLength,t.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");for(t=new s(e.length,i,r),t.limit=e.length,i=0;i<e.length;++i)t.view[i]=e[i]}return t},o.writeBitSet=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n=t,s=e.length,o=s>>3,a=0;for(t+=this.writeVarint32(s,t);o--;)r=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(r,t++);if(a<s){for(r=o=0;a<s;)r|=(1&!!e[a++])<<o++;this.writeByte(r,t++)}return i?(this.offset=t,this):t-n},o.readBitSet=function(e){var t="undefined"==typeof e;t&&(e=this.offset);var i=this.readVarint32(e),r=i.value,n=r>>3,s=0,o=[];for(e+=i.length;n--;)i=this.readByte(e++),o[s++]=!!(1&i),o[s++]=!!(2&i),o[s++]=!!(4&i),o[s++]=!!(8&i),o[s++]=!!(16&i),o[s++]=!!(32&i),o[s++]=!!(64&i),o[s++]=!!(128&i);if(s<r)for(n=0,i=this.readByte(e++);s<r;)o[s++]=!!(i>>n++&1);return t&&(this.offset=e),o},o.readBytes=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var r=this.slice(t,t+e);return i&&(this.offset+=e),r},o.writeBytes=o.append,o.writeInt8=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),this.view[t-1]=e,i&&(this.offset+=1),this},o.writeByte=o.writeInt8,o.readInt8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return e=this.view[e],128===(128&e)&&(e=-(255-e+1)),t&&(this.offset+=1),e},o.readByte=o.readInt8,o.writeUint8=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),this.view[t-1]=e,i&&(this.offset+=1),this},o.writeUInt8=o.writeUint8,o.readUint8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return e=this.view[e],t&&(this.offset+=1),e},o.readUInt8=o.readUint8,o.writeInt16=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeShort=o.writeInt16,o.readInt16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),32768===(32768&i)&&(i=-(65535-i+1)),t&&(this.offset+=2),i},o.readShort=o.readInt16,o.writeUint16=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeUInt16=o.writeUint16,o.readUint16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),t&&(this.offset+=2),i},o.readUInt16=o.readUint16,o.writeInt32=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeInt=o.writeInt32,o.readInt32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),0|i},o.readInt=o.readInt32,o.writeUint32=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeUInt32=o.writeUint32,o.readUint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),i},o.readUInt32=o.readUint32,e&&(o.writeInt64=function(t,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var n=this.buffer.byteLength;i>n&&this.resize((n*=2)>i?n:i),i-=8;var n=t.low,s=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=s>>>24&255,this.view[i+2]=s>>>16&255,this.view[i+1]=s>>>8&255,this.view[i]=255&s):(this.view[i]=s>>>24&255,this.view[i+1]=s>>>16&255,this.view[i+2]=s>>>8&255,this.view[i+3]=255&s,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},o.writeLong=o.writeInt64,o.readInt64=function(t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),t=new e(r,n,!1),i&&(this.offset+=8),t},o.readLong=o.readInt64,o.writeUint64=function(t,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var n=this.buffer.byteLength;i>n&&this.resize((n*=2)>i?n:i),i-=8;var n=t.low,s=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=s>>>24&255,this.view[i+2]=s>>>16&255,this.view[i+1]=s>>>8&255,this.view[i]=255&s):(this.view[i]=s>>>24&255,this.view[i+1]=s>>>16&255,this.view[i+2]=s>>>8&255,this.view[i+3]=255&s,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},o.writeUInt64=o.writeUint64,o.readUint64=function(t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),t=new e(r,n,!0),i&&(this.offset+=8),t},o.readUInt64=o.readUint64),o.writeFloat32=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),n(this.view,e,t-4,this.littleEndian,23,4),i&&(this.offset+=4),this},o.writeFloat=o.writeFloat32,o.readFloat32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}return e=r(this.view,e,this.littleEndian,23,4),t&&(this.offset+=4),e},o.readFloat=o.readFloat32,o.writeFloat64=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),n(this.view,e,t-8,this.littleEndian,52,8),i&&(this.offset+=8),this},o.writeDouble=o.writeFloat64,o.readFloat64=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}return e=r(this.view,e,this.littleEndian,52,8),t&&(this.offset+=8),e},o.readDouble=o.readFloat64,s.MAX_VARINT32_BYTES=5,s.calculateVarint32=function(e){return e>>>=0,128>e?1:16384>e?2:2097152>e?3:268435456>e?4:5},s.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},s.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},o.writeVarint32=function(e,t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n=s.calculateVarint32(e);for(t+=n,r=this.buffer.byteLength,t>r&&this.resize((r*=2)>t?r:t),t-=n,e>>>=0;128<=e;)r=127&e|128,this.view[t++]=r,e>>>=7;return this.view[t++]=e,i?(this.offset=t,this):n},o.writeVarint32ZigZag=function(e,t){return this.writeVarint32(s.zigZagEncode32(e),t)},o.readVarint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=0,n=0;do{if(!this.noAssert&&e>this.limit)throw e=Error("Truncated"),e.truncated=!0,e;i=this.view[e++],5>r&&(n|=(127&i)<<7*r),++r}while(0!==(128&i));return n|=0,t?(this.offset=e,n):{value:n,length:r}},o.readVarint32ZigZag=function(e){return e=this.readVarint32(e),"object"==typeof e?e.value=s.zigZagDecode32(e.value):e=s.zigZagDecode32(e),e},e&&(s.MAX_VARINT64_BYTES=10,s.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var i=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0;return t=t.shiftRightUnsigned(56).toInt()>>>0,0==t?0==r?16384>i?128>i?1:2:2097152>i?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>t?9:10},s.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},s.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},o.writeVarint64=function(t,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned());var n=s.calculateVarint64(t),o=t.toInt()>>>0,a=t.shiftRightUnsigned(28).toInt()>>>0,f=t.shiftRightUnsigned(56).toInt()>>>0;i+=n;var h=this.buffer.byteLength;switch(i>h&&this.resize((h*=2)>i?h:i),i-=n,n){case 10:this.view[i+9]=f>>>7&1;case 9:this.view[i+8]=9!==n?128|f:127&f;case 8:this.view[i+7]=8!==n?a>>>21|128:a>>>21&127;case 7:this.view[i+6]=7!==n?a>>>14|128:a>>>14&127;case 6:this.view[i+5]=6!==n?a>>>7|128:a>>>7&127;case 5:this.view[i+4]=5!==n?128|a:127&a;case 4:this.view[i+3]=4!==n?o>>>21|128:o>>>21&127;case 3:this.view[i+2]=3!==n?o>>>14|128:o>>>14&127;case 2:this.view[i+1]=2!==n?o>>>7|128:o>>>7&127;case 1:this.view[i]=1!==n?128|o:127&o}return r?(this.offset+=n,this):n},o.writeVarint64ZigZag=function(e,t){return this.writeVarint64(s.zigZagEncode64(e),t)},o.readVarint64=function(t){var i="undefined"==typeof t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,n=0,s=0,o=0,a=0,a=this.view[t++],n=127&a;if(128&a&&(a=this.view[t++],n|=(127&a)<<7,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],n|=(127&a)<<14,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],n|=(127&a)<<21,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],s=127&a,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],s|=(127&a)<<7,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],s|=(127&a)<<14,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],s|=(127&a)<<21,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],o=127&a,128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[t++],o|=(127&a)<<7,128&a||this.noAssert&&"undefined"==typeof a))throw Error("Buffer overrun");return n=e.fromBits(n|s<<28,s>>>4|o<<24,!1),i?(this.offset=t,n):{value:n,length:t-r}},o.readVarint64ZigZag=function(t){return(t=this.readVarint64(t))&&t.value instanceof e?t.value=s.zigZagDecode64(t.value):t=s.zigZagDecode64(t),t}),o.writeCString=function(e,i){var r="undefined"==typeof i;r&&(i=this.offset);var n,s=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(n=0;n<s;++n)if(0===e.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}return s=l.calculateUTF16asUTF8(t(e))[1],i+=s+1,n=this.buffer.byteLength,i>n&&this.resize((n*=2)>i?n:i),i-=s+1,l.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),this.view[i++]=0,r?(this.offset=i,this):s},o.readCString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,s=-1;return l.decodeUTF8toUTF16(function(){if(0===s)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return s=this.view[e++],0===s?null:s}.bind(this),r=i(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},o.writeIString=function(e,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,s=i;n=l.calculateUTF16asUTF8(t(e),this.noAssert)[1],i+=4+n;var o=this.buffer.byteLength;if(i>o&&this.resize((o*=2)>i?o:i),i-=4+n,this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n):(this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),i+=4,l.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),i!==s+4+n)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+4+n));return r?(this.offset=i,this):i-s},o.readIString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=e,r=this.readUint32(e),r=this.readUTF8String(r,s.METRICS_BYTES,e+=4);return e+=r.length,t?(this.offset=e,r.string):{string:r.string,length:e-i}},s.METRICS_CHARS="c",s.METRICS_BYTES="b",o.writeUTF8String=function(e,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,s=i;n=l.calculateUTF16asUTF8(t(e))[1],i+=n;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=n,l.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),r?(this.offset=i,this):i-s},o.writeString=o.writeUTF8String,s.calculateUTF8Chars=function(e){return l.calculateUTF16asUTF8(t(e))[0]},s.calculateUTF8Bytes=function(e){
return l.calculateUTF16asUTF8(t(e))[1]},s.calculateString=s.calculateUTF8Bytes,o.readUTF8String=function(e,t,r){"number"==typeof t&&(r=t,t=void 0);var n="undefined"==typeof r;if(n&&(r=this.offset),"undefined"==typeof t&&(t=s.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||0!==r%1)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,a=0,f=r;if(t===s.METRICS_CHARS){if(o=i(),l.decodeUTF8(function(){return a<e&&r<this.limit?this.view[r++]:null}.bind(this),function(e){++a,l.UTF8toUTF16(e,o)}),a!==e)throw RangeError("Illegal range: Truncated data, "+a+" == "+e);return n?(this.offset=r,o()):{string:o(),length:r-f}}if(t===s.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||0!==r%1)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var h=r+e;if(l.decodeUTF8toUTF16(function(){return r<h?this.view[r++]:null}.bind(this),o=i(),this.noAssert),r!==h)throw RangeError("Illegal range: Truncated data, "+r+" == "+h);return n?(this.offset=r,o()):{string:o(),length:r-f}}throw TypeError("Unsupported metrics: "+t)},o.readString=o.readUTF8String,o.writeVString=function(e,i){var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,o,a=i;n=l.calculateUTF16asUTF8(t(e),this.noAssert)[1],o=s.calculateVarint32(n),i+=o+n;var f=this.buffer.byteLength;if(i>f&&this.resize((f*=2)>i?f:i),i-=o+n,i+=this.writeVarint32(n,i),l.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),i!==a+n+o)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+n+o));return r?(this.offset=i,this):i-a},o.readVString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,r=this.readVarint32(e),r=this.readUTF8String(r.value,s.METRICS_BYTES,e+=r.length);return e+=r.length,t?(this.offset=e,r.string):{string:r.string,length:e-i}},o.append=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}if(e instanceof s||(e=s.wrap(e,t)),t=e.limit-e.offset,0>=t)return this;i+=t;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=t,this.view.set(e.view.subarray(e.offset,e.limit),i),e.offset+=t,r&&(this.offset+=t),this},o.appendTo=function(e,t){return e.append(this,t),this},o.assert=function(e){return this.noAssert=!e,this},o.capacity=function(){return this.buffer.byteLength},o.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},o.clone=function(e){var t=new s(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},o.compact=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var i=t-e;if(0===i)return this.buffer=a,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.limit=this.offset=0,this;var r=new ArrayBuffer(i),n=new Uint8Array(r);return n.set(this.view.subarray(e,t)),this.buffer=r,this.view=n,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=i,this},o.copy=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new s(0,this.littleEndian,this.noAssert);var i=t-e,r=new s(i,this.littleEndian,this.noAssert);return r.offset=0,r.limit=i,0<=r.markedOffset&&(r.markedOffset-=e),this.copyTo(r,0,e,t),r},o.copyTo=function(e,t,i,r){var n,o;if(!this.noAssert&&!s.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(o="undefined"==typeof t)?e.offset:0|t,i=(n="undefined"==typeof i)?this.offset:0|i,r="undefined"==typeof r?this.limit:0|r,0>t||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(0>i||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var a=r-i;return 0===a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(i,r),t),n&&(this.offset+=a),o&&(e.offset+=a),this)},o.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},o.fill=function(e,t,i){var r="undefined"==typeof t;if(r&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),"undefined"==typeof t&&(t=this.offset),"undefined"==typeof i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||0!==i%1)throw TypeError("Illegal end: Not an integer");if(i>>>=0,0>t||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(t>=i)return this;for(;t<i;)this.view[t++]=e;return r&&(this.offset=t),this},o.flip=function(){return this.limit=this.offset,this.offset=0,this},o.mark=function(e){if(e="undefined"==typeof e?this.offset:e,!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},o.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},o.LE=function(e){return this.littleEndian="undefined"==typeof e||!!e,this},o.BE=function(e){return this.littleEndian="undefined"!=typeof e&&!e,this},o.prepend=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var r="undefined"==typeof i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}if(e instanceof s||(e=s.wrap(e,t)),t=e.limit-e.offset,0>=t)return this;var n=t-i;if(0<n){var o=new ArrayBuffer(this.buffer.byteLength+n),a=new Uint8Array(o);a.set(this.view.subarray(i,this.buffer.byteLength),t),this.buffer=o,this.view=a,this.offset+=n,0<=this.markedOffset&&(this.markedOffset+=n),this.limit+=n,i+=n}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),i-t),e.offset=e.limit,r&&(this.offset-=t),this},o.prependTo=function(e,t){return e.prepend(this,t),this},o.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},o.remaining=function(){return this.limit-this.offset},o.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},o.resize=function(e){if(!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal capacity: "+e+" (not an integer)");if(e|=0,0>e)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){e=new ArrayBuffer(e);var t=new Uint8Array(e);t.set(this.view),this.buffer=e,this.view=t}return this},o.reverse=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t?this:(Array.prototype.reverse.call(this.view.subarray(e,t)),this)},o.skip=function(e){if(!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(0>t||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},o.slice=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=e,i.limit=t,i},o.toBuffer=function(e){var t=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof i||0!==i%1)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,0>t||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}return e||0!==t||i!==this.buffer.byteLength?t===i?a:(e=new ArrayBuffer(i-t),new Uint8Array(e).set(new Uint8Array(this.buffer).subarray(t,i),0),e):this.buffer},o.toArrayBuffer=o.toBuffer,o.toString=function(e,t,i){if("undefined"==typeof e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(i=t=e="utf8"),e){case"utf8":return this.toUTF8(t,i);case"base64":return this.toBase64(t,i);case"hex":return this.toHex(t,i);case"binary":return this.toBinary(t,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var h=function(){for(var e={},t=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],r=0,n=t.length;r<n;++r)i[t[r]]=r;return e.encode=function(e,i){for(var r,n;null!==(r=e());)i(t[r>>2&63]),n=(3&r)<<4,null!==(r=e())?(n|=r>>4&15,i(t[63&(n|r>>4&15)]),n=(15&r)<<2,null!==(r=e())?(i(t[63&(n|r>>6&3)]),i(t[63&r])):(i(t[63&n]),i(61))):(i(t[63&n]),i(61),i(61))},e.decode=function(e,t){function r(e){throw Error("Illegal character code: "+e)}for(var n,s,o;null!==(n=e());)if(s=i[n],"undefined"==typeof s&&r(n),null!==(n=e())&&(o=i[n],"undefined"==typeof o&&r(n),t(s<<2>>>0|(48&o)>>4),null!==(n=e()))){if(s=i[n],"undefined"==typeof s){if(61===n)break;r(n)}if(t((15&o)<<4>>>0|(60&s)>>2),null!==(n=e())){if(o=i[n],"undefined"==typeof o){if(61===n)break;r(n)}t((3&s)<<6>>>0|o)}}},e.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)},e}();o.toBase64=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),e|=0,t|=0,0>e||t>this.capacity||e>t)throw RangeError("begin, end");var r;return h.encode(function(){return e<t?this.view[e++]:null}.bind(this),r=i()),r()},s.fromBase64=function(e,i){if("string"!=typeof e)throw TypeError("str");var r=new s(e.length/4*3,i),n=0;return h.decode(t(e),function(e){r.view[n++]=e}),r.limit=n,r},s.btoa=function(e){return s.fromBinary(e).toBase64()},s.atob=function(e){return s.fromBase64(e).toBinary()},o.toBinary=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),e|=0,t|=0,0>e||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var i=[],r=[];e<t;)i.push(this.view[e++]),1024<=i.length&&(r.push(String.fromCharCode.apply(String,i)),i=[]);return r.join("")+String.fromCharCode.apply(String,i)},s.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var i,r=0,n=e.length,o=new s(n,t);r<n;){if(i=e.charCodeAt(r),255<i)throw RangeError("illegal char code: "+i);o.view[r++]=i}return o.limit=n,o},o.toDebug=function(e){for(var t,i=-1,r=this.buffer.byteLength,n="",s="",o="";i<r;){if(-1!==i&&(t=this.view[i],n=16>t?n+("0"+t.toString(16).toUpperCase()):n+t.toString(16).toUpperCase(),e&&(s+=32<t&&127>t?String.fromCharCode(t):".")),++i,e&&0<i&&0===i%16&&i!==r){for(;51>n.length;)n+=" ";o+=n+s+"\n",n=s=""}n=i===this.offset&&i===this.limit?n+(i===this.markedOffset?"!":"|"):i===this.offset?n+(i===this.markedOffset?"[":"<"):i===this.limit?n+(i===this.markedOffset?"]":">"):n+(i===this.markedOffset?"'":e||0!==i&&i!==r?" ":"")}if(e&&" "!==n){for(;51>n.length;)n+=" ";o+=n+s+"\n"}return e?o:n},s.fromDebug=function(e,t,i){var r=e.length;t=new s((r+1)/3|0,t,i);for(var n,o=0,a=0,f=!1,h=!1,l=!1,u=!1,c=!1;o<r;){switch(n=e.charAt(o++)){case"!":if(!i){if(h||l||u){c=!0;break}h=l=u=!0}t.offset=t.markedOffset=t.limit=a,f=!1;break;case"|":if(!i){if(h||u){c=!0;break}h=u=!0}t.offset=t.limit=a,f=!1;break;case"[":if(!i){if(h||l){c=!0;break}h=l=!0}t.offset=t.markedOffset=a,f=!1;break;case"<":if(!i){if(h){c=!0;break}h=!0}t.offset=a,f=!1;break;case"]":if(!i){if(u||l){c=!0;break}u=l=!0}t.limit=t.markedOffset=a,f=!1;break;case">":if(!i){if(u){c=!0;break}u=!0}t.limit=a,f=!1;break;case"'":if(!i){if(l){c=!0;break}l=!0}t.markedOffset=a,f=!1;break;case" ":f=!1;break;default:if(!i&&f){c=!0;break}if(n=parseInt(n+e.charAt(o++),16),!i&&(isNaN(n)||0>n||255<n))throw TypeError("Illegal str: Not a debug encoded string");t.view[a++]=n,f=!0}if(c)throw TypeError("Illegal str: Invalid symbol at "+o)}if(!i){if(!h||!u)throw TypeError("Illegal str: Missing offset or limit");if(a<t.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+a+" < "+r)}return t},o.toHex=function(e,t){if(e="undefined"==typeof e?this.offset:e,t="undefined"==typeof t?this.limit:t,!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var i,r=Array(t-e);e<t;)i=this.view[e++],16>i?r.push("0",i.toString(16)):r.push(i.toString(16));return r.join("")},s.fromHex=function(e,t,i){if(!i){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(0!==e.length%2)throw TypeError("Illegal str: Length not a multiple of 2")}var r=e.length;t=new s(r/2|0,t);for(var n,o=0,a=0;o<r;o+=2){if(n=parseInt(e.substring(o,o+2),16),!i&&(!isFinite(n)||0>n||255<n))throw TypeError("Illegal str: Contains non-hex characters");t.view[a++]=n}return t.limit=a,t};var l=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)128>i?t(127&i):(2048>i?t(i>>6&31|192):(65536>i?t(i>>12&15|224):(t(i>>18&7|240),t(i>>12&63|128)),t(i>>6&63|128)),t(63&i|128)),i=null},decodeUTF8:function(e,t){for(var i,r,n,s,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(i=e());)if(0===(128&i))t(i);else if(192===(224&i))null===(r=e())&&o([i,r]),t((31&i)<<6|63&r);else if(224===(240&i))null!==(r=e())&&null!==(n=e())||o([i,r,n]),t((15&i)<<12|(63&r)<<6|63&n);else{if(240!==(248&i))throw RangeError("Illegal starting byte: "+i);null!==(r=e())&&null!==(n=e())&&null!==(s=e())||o([i,r,n,s]),t((7&i)<<18|(63&r)<<12|(63&n)<<6|63&s)}},UTF16toUTF8:function(e,t){for(var i,r=null;null!==(i=null!==r?r:e());)55296<=i&&57343>=i&&null!==(r=e())&&56320<=r&&57343>=r?(t(1024*(i-55296)+r-56320+65536),r=null):t(i);null!==r&&t(r)},UTF8toUTF16:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)65535>=i?t(i):(i-=65536,t((i>>10)+55296),t(i%1024+56320)),i=null},encodeUTF16toUTF8:function(t,i){e.UTF16toUTF8(t,function(t){e.encodeUTF8(t,i)})},decodeUTF8toUTF16:function(t,i){e.decodeUTF8(t,function(t){e.UTF8toUTF16(t,i)})},calculateCodePoint:function(e){return 128>e?1:2048>e?2:65536>e?3:4},calculateUTF8:function(e){for(var t,i=0;null!==(t=e());)i+=128>t?1:2048>t?2:65536>t?3:4;return i},calculateUTF16asUTF8:function(t){var i=0,r=0;return e.UTF16toUTF8(t,function(e){++i,r+=128>e?1:2048>e?2:65536>e?3:4}),[i,r]}};return e}();return o.toUTF8=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||0!==t%1)throw TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r;try{l.decodeUTF8toUTF16(function(){return e<t?this.view[e++]:null}.bind(this),r=i())}catch(i){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return r()},s.fromUTF8=function(e,i,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var n=new s(l.calculateUTF16asUTF8(t(e),!0)[1],i,r),o=0;return l.encodeUTF16toUTF8(t(e),function(e){n.view[o++]=e}),n.limit=o,n},s}),function(e,t){"function"==typeof define&&define.amd?define("protobuf",["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(e,t){var i={};return i.ByteBuffer=e,i.Long=e.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=function(){var e={};return e.IS_NODE=!("object"!=typeof process||"[object process]"!=process+""||process.browser),e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,i){if(i&&"function"!=typeof i&&(i=null),e.IS_NODE){var r=require("fs");if(i)r.readFile(t,function(e,t){i(e?null:""+t)});else try{return r.readFileSync(t)}catch(e){return null}}else{var n=e.XHR();if(n.open("GET",t,!!i),n.setRequestHeader("Accept","text/plain"),"function"==typeof n.overrideMimeType&&n.overrideMimeType("text/plain"),!i)return n.send(null),200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null;n.onreadystatechange=function(){4==n.readyState&&i(200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null)},4!=n.readyState&&n.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},e}(),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(e,t){function i(e,i){var r=-1,n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))r=parseInt(e);else if(t.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(0>n?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=n*r|0,!i&&0>r)throw Error("illegal id value: "+(0>n?"-":"")+e);return r}function r(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*parseInt(e,10);if(t.NUMBER_HEX.test(e))return i*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*parseInt(e.substring(1),8);if("inf"===e)return 1/0*i;if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return i*parseFloat(e);throw Error("illegal number value: "+(0>i?"-":"")+e)}function n(e,t,i){"undefined"==typeof e[t]?e[t]=i:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(i))}var s={},o=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},a=o.prototype;a._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var i=e.exec(this.source);if(!i)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},a.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,i;do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if("\n"===i&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(i=this.source.charAt(this.index)))return"/";do{if("\n"===i&&++this.line,++this.index===this.source.length)return null;e=i,i=this.source.charAt(this.index)}while("*"!==e||"/"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(i=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)++i;return i=this.source.substring(this.index,this.index=i),'"'!==i&&"'"!==i||(this._stringOpen=i),i},a.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},a.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},a.omit=function(e){return this.peek()===e&&(this.next(),!0)},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},s.Tokenizer=o;var f=function(e){this.tn=new o(e),this.proto3=!1},a=f.prototype;return a.parse=function(){var e,i,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!n||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!n)throw Error("unexpected 'import'");e=this.tn.peek(),("public"===e||(i="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),i||r.imports.push(e);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),n=!1;break;case"enum":this._parseEnum(r),n=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},f.parse=function(e){return new f(e).parse()},a._readString=function(){var e,t="";do{if(e=this.tn.next(),"'"!==e&&'"'!==e)throw Error("illegal string delimiter: "+e);t+=this.tn.next(),this.tn.skip(e),e=this.tn.peek()}while('"'===e||'"'===e);return t},a._readValue=function(e){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),t.NUMBER.test(i))return r(i);if(t.BOOL.test(i))return"true"===i.toLowerCase();if(e&&t.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},a._parseOption=function(e,i){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error("illegal option name: "+r);var s=r;n&&(this.tn.skip(")"),s="("+s+")",r=this.tn.peek(),t.FQTYPEREF.test(r)&&(s+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,s),i||this.tn.skip(";")},a._parseOptionValue=function(e,i){var r=this.tn.peek();if("{"!==r)n(e.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!t.NAME.test(r))throw Error("illegal option name: "+i+"."+r);this.tn.omit(":")?n(e.options,i+"."+r,this._readValue(!0)):this._parseOptionValue(e,i+"."+r)}},a._parseService=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var r={name:i,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(r);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},a._parseServiceRPC=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal rpc service method name: "+i);var r=i,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(n.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(n.request=i,this.tn.skip(")"),i=this.tn.next(),"returns"!==i.toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(n.response_stream=!0,i=this.tn.next()),n.response=i,this.tn.skip(")"),i=this.tn.peek(),"{"===i){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof e.rpc&&(e.rpc={}),e.rpc[r]=n},a._parseMessage=function(e,r){var n=!!r,s=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(s))throw Error("illegal "+(n?"group":"message")+" name: "+s);for(o.name=s,n&&(this.tn.skip("="),r.id=i(this.tn.next()),o.isGroup=!0),s=this.tn.peek(),"["===s&&r&&this._parseFieldOptions(r),this.tn.skip("{");"}"!==(s=this.tn.next());)if(t.RULE.test(s))this._parseMessageField(o,s);else if("oneof"===s)this._parseMessageOneOf(o);else if("enum"===s)this._parseEnum(o);else if("message"===s)this._parseMessage(o);else if("option"===s)this._parseOption(o);else if("service"===s)this._parseService(o);else if("extensions"===s)o.hasOwnProperty("extensions")?o.extensions=o.extensions.concat(this._parseExtensionRanges()):o.extensions=this._parseExtensionRanges();else if("reserved"===s)this._parseIgnored();else if("extend"===s)this._parseExtend(o);else{if(!t.TYPEREF.test(s))throw Error("illegal message token: "+s);if(!this.proto3)throw Error("illegal field rule: "+s);this._parseMessageField(o,"optional",s)}return this.tn.omit(";"),e.messages.push(o),o},a._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},a._parseMessageField=function(e,r,n){if(!t.RULE.test(r))throw Error("illegal message field rule: "+r);var s={rule:r,type:"",name:"",options:{},id:0};if("map"===r){if(n)throw Error("illegal type: "+n);if(this.tn.skip("<"),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(s.keytype=r,this.tn.skip(","),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field: "+r);if(s.type=r,this.tn.skip(">"),r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=i(this.tn.next()),r=this.tn.peek(),"["===r&&this._parseFieldOptions(s),this.tn.skip(";")}else if(n="undefined"!=typeof n?n:this.tn.next(),"group"===n){if(r=this._parseMessage(e,s),!/^[A-Z]/.test(r.name))throw Error("illegal group name: "+r.name);s.type=r.name,s.name=r.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(s.type=n,r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=i(this.tn.next()),r=this.tn.peek(),"["===r&&this._parseFieldOptions(s),this.tn.skip(";")}return e.fields.push(s),s},a._parseMessageOneOf=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal oneof name: "+i);var r=i,n=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)i=this._parseMessageField(e,"optional",i),i.oneof=r,n.push(i.id);this.tn.omit(";"),e.oneofs[r]=n},a._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},a._parseEnum=function(e){var r={name:"",values:[],options:{}},n=this.tn.next();if(!t.NAME.test(n))throw Error("illegal name: "+n);for(r.name=n,this.tn.skip("{");"}"!==(n=this.tn.next());)if("option"===n)this._parseOption(r);else{if(!t.NAME.test(n))throw Error("illegal name: "+n);
this.tn.skip("=");var s={name:n,id:i(this.tn.next(),!0)},n=this.tn.peek();"["===n&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),r.values.push(s)}this.tn.omit(";"),e.enums.push(r)},a._parseExtensionRanges=function(){var t,i,n=[];do{for(i=[];;){switch(t=this.tn.next()){case"min":t=e.ID_MIN;break;case"max":t=e.ID_MAX;break;default:t=r(t)}if(i.push(t),2===i.length)break;if("to"!==this.tn.peek()){i.push(t);break}this.tn.next()}n.push(i)}while(this.tn.omit(","));return this.tn.skip(";"),n},a._parseExtend=function(e){var i=this.tn.next();if(!t.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var r={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(r,i);else{if(!t.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(r,"optional",i)}return this.tn.omit(";"),e.messages.push(r),r},a.toString=function(){return"Parser at line "+this.tn.line},s.Parser=f,s}(i,i.Lang),i.Reflect=function(t){function i(e,i){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,"undefined"==typeof i?e.unsigned:i);if("string"==typeof e)return t.Long.fromString(e,i||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,i||!1);throw Error("not convertible to Long")}function r(e,i){var n=i.readVarint32(),s=7&n,n=n>>>3;switch(s){case t.WIRE_TYPES.VARINT:do n=i.readUint8();while(128===(128&n));break;case t.WIRE_TYPES.BITS64:i.offset+=8;break;case t.WIRE_TYPES.LDELIM:n=i.readVarint32(),i.offset+=n;break;case t.WIRE_TYPES.STARTGROUP:r(n,i);break;case t.WIRE_TYPES.ENDGROUP:if(n===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+s)}return!0}var n={},s=function(e,t,i){this.builder=e,this.parent=t,this.name=i},o=s.prototype;o.fqn=function(){for(var e=this.name,t=this;;){if(t=t.parent,null==t)break;e=t.name+"."+e}return e},o.toString=function(e){return(e?this.className+" ":"")+this.fqn()},o.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=s;var a=function(e,t,i,r,n){s.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=n||"proto2"},o=a.prototype=Object.create(s.prototype);o.getChildren=function(e){if(e=e||null,null==e)return this.children.slice();for(var t=[],i=0,r=this.children.length;i<r;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},o.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof l.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof l.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},o.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,r=this.children.length;i<r;++i)if(this.children[i][t]===e)return this.children[i];return null},o.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,r=this,s=0;if(""===i[s]){for(;null!==r.parent;)r=r.parent;s++}do{do{if(!(r instanceof n.Namespace)){r=null;break}if(r=r.getChild(i[s]),!(r&&r instanceof n.T)||t&&!(r instanceof n.Namespace)){r=null;break}s++}while(s<i.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},o.qn=function(e){var t=[],i=e;do t.unshift(i.name),i=i.parent;while(null!==i);for(i=1;i<=t.length;i++){var r=t.slice(t.length-i);if(e===this.resolve(r,e instanceof n.Namespace))return r.join(".")}return e.fqn()},o.build=function(){for(var e,t={},i=this.children,r=0,n=i.length;r<n;++r)e=i[r],e instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},o.buildOpt=function(){for(var e={},t=Object.keys(this.options),i=0,r=t.length;i<r;++i)e[t[i]]=this.options[t[i]];return e},o.getOption=function(e){return"undefined"==typeof e?this.options:"undefined"!=typeof this.options[e]?this.options[e]:null},n.Namespace=a;var f=function(e,i,r,n,s){if(this.type=e,this.resolvedType=i,this.isMapKey=r,this.syntax=n,this.name=s,r&&0>t.MAP_KEY_TYPES.indexOf(e))throw Error("Invalid map key type: "+e.name)},h=f.prototype;f.defaultFieldValue=function(i){if("string"==typeof i&&(i=t.TYPES[i]),"undefined"==typeof i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==t.TYPES.bytes?new e(0):i.defaultValue},h.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},h.verifyValue=function(r){function n(e,t){throw Error("Illegal value for "+s.toString(!0)+" of type "+s.type.name+": "+e+" ("+t+")")}var s=this;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),4294967295<r?0|r:r;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),0>r?r>>>0:r;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(r,!1)}catch(e){n(typeof r,e.message)}else n(typeof r,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(r,!0)}catch(e){n(typeof r,e.message)}else n(typeof r,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof r&&n(typeof r,"not a boolean"),r;case t.TYPES.float:case t.TYPES.double:return"number"!=typeof r&&n(typeof r,"not a number"),r;case t.TYPES.string:return"string"==typeof r||r&&r instanceof String||n(typeof r,"not a string"),""+r;case t.TYPES.bytes:return e.isByteBuffer(r)?r:e.wrap(r,"base64");case t.TYPES.enum:for(var o=this.resolvedType.getChildren(t.Reflect.Enum.Value),a=0;a<o.length;a++)if(o[a].name==r||o[a].id==r)return o[a].id;if("proto3"===this.syntax)return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),(4294967295<r||0>r)&&n(typeof r,"not in range for uint32"),r;n(r,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(r&&"object"==typeof r||n(typeof r,"object expected"),r instanceof this.resolvedType.clazz)return r;if(r instanceof t.Builder.Message){var a,o={};for(a in r)r.hasOwnProperty(a)&&(o[a]=r[a]);r=o}return new this.resolvedType.clazz(r)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+r+" (undefined type "+this.type+")")},h.calculateLength=function(i,r){if(null===r)return 0;var n;switch(this.type){case t.TYPES.int32:return 0>r?e.calculateVarint64(r):e.calculateVarint32(r);case t.TYPES.uint32:return e.calculateVarint32(r);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(r));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(r);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(r));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return e.calculateVarint32(r);case t.TYPES.double:return 8;case t.TYPES.string:return n=e.calculateUTF8Bytes(r),e.calculateVarint32(n)+n;case t.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return e.calculateVarint32(r.remaining())+r.remaining();case t.TYPES.message:return n=this.resolvedType.calculate(r),e.calculateVarint32(n)+n;case t.TYPES.group:return n=this.resolvedType.calculate(r),n+e.calculateVarint32(i<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},h.encodeValue=function(i,r,n){if(null===r)return n;switch(this.type){case t.TYPES.int32:0>r?n.writeVarint64(r):n.writeVarint32(r);break;case t.TYPES.uint32:n.writeVarint32(r);break;case t.TYPES.sint32:n.writeVarint32ZigZag(r);break;case t.TYPES.fixed32:n.writeUint32(r);break;case t.TYPES.sfixed32:n.writeInt32(r);break;case t.TYPES.int64:case t.TYPES.uint64:n.writeVarint64(r);break;case t.TYPES.sint64:n.writeVarint64ZigZag(r);break;case t.TYPES.fixed64:n.writeUint64(r);break;case t.TYPES.sfixed64:n.writeInt64(r);break;case t.TYPES.bool:"string"==typeof r?n.writeVarint32("false"===r.toLowerCase()?0:!!r):n.writeVarint32(r?1:0);break;case t.TYPES.enum:n.writeVarint32(r);break;case t.TYPES.float:n.writeFloat32(r);break;case t.TYPES.double:n.writeFloat64(r);break;case t.TYPES.string:n.writeVString(r);break;case t.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");i=r.offset,n.writeVarint32(r.remaining()),n.append(r),r.offset=i;break;case t.TYPES.message:i=(new e).LE(),this.resolvedType.encode(r,i),n.writeVarint32(i.offset),n.append(i.flip());break;case t.TYPES.group:this.resolvedType.encode(r,n),n.writeVarint32(i<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return n},h.decode=function(e,i,r){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(r=e.readVarint32(),e.remaining()<r)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+r+" required but got only "+e.remaining());return i=e.clone(),i.limit=i.offset+r,e.offset+=r,i;case t.TYPES.message:return r=e.readVarint32(),this.resolvedType.decode(e,r);case t.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},h.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(i));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(i);case t.TYPES.bool:return"true"===i;case t.TYPES.string:return this.verifyValue(i);case t.TYPES.bytes:return e.fromBinary(i)}},h.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===t.TYPES.bytes?e.toString("binary"):e.toString()},n.Element=f;var l=function(e,t,i,r,n,s){a.call(this,e,t,i,r,s),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!n,this._fieldsByName=this._fieldsById=this._fields=null},h=l.prototype=Object.create(a.prototype);h.build=function(i){if(this.clazz&&!i)return this.clazz;i=function(t,i){function r(i,n,s,o){if(null===i||"object"!=typeof i){if(o&&o instanceof t.Reflect.Enum){var a=t.Reflect.Enum.getName(o.object,i);if(null!==a)return a}return i}if(e.isByteBuffer(i))return n?i.toBase64():i.toBuffer();if(t.Long.isLong(i))return s?i.toString():t.Long.fromValue(i);var f;if(Array.isArray(i))return f=[],i.forEach(function(e,t){f[t]=r(e,n,s,o)}),f;if(f={},i instanceof t.Map){for(var a=i.entries(),h=a.next();!h.done;h=a.next())f[i.keyElem.valueToString(h.value[0])]=r(h.value[1],n,s,i.valueElem.resolvedType);return f}var l,a=i.$type,h=void 0;for(l in i)i.hasOwnProperty(l)&&(a&&(h=a.getChild(l))?f[l]=r(i[l],n,s,h.resolvedType):f[l]=r(i[l],n,s));return f}var n=i.getChildren(t.Reflect.Message.Field),s=i.getChildren(t.Reflect.Message.OneOf),o=function(r,a){t.Builder.Message.call(this);for(var f=0,h=s.length;f<h;++f)this[s[f].name]=null;for(f=0,h=n.length;f<h;++f){var l=n[f];this[l.name]=l.repeated?[]:l.map?new t.Map(l):null,!l.required&&"proto3"!==i.syntax||null===l.defaultValue||(this[l.name]=l.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===r||"object"!=typeof r||!("function"!=typeof r.encode||r instanceof o)||Array.isArray(r)||r instanceof t.Map||e.isByteBuffer(r)||r instanceof ArrayBuffer||t.Long&&r instanceof t.Long)for(f=0,h=arguments.length;f<h;++f)"undefined"!=typeof(l=arguments[f])&&this.$set(n[f].name,l);else this.$set(r)},a=o.prototype=Object.create(t.Builder.Message.prototype);a.add=function(e,r,n){var s=i._fieldsByName[e];if(!n){if(!s)throw Error(this+"#"+e+" is undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));if(!s.repeated)throw Error(this+"#"+e+" is not a repeated field");r=s.verifyValue(r,!0)}return null===this[e]&&(this[e]=[]),this[e].push(r),this},a.$add=a.add,a.set=function(e,r,n){if(e&&"object"==typeof e){n=r;for(var s in e)e.hasOwnProperty(s)&&"undefined"!=typeof(r=e[s])&&this.$set(s,r,n);return this}if(s=i._fieldsByName[e],n)this[e]=r;else{if(!s)throw Error(this+"#"+e+" is not a field: undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));this[s.name]=r=s.verifyValue(r)}return s&&s.oneof&&(n=this[s.oneof.name],null!==r?(null!==n&&n!==s.name&&(this[n]=null),this[s.oneof.name]=s.name):n===e&&(this[s.oneof.name]=null)),this},a.$set=a.set,a.get=function(e,r){if(r)return this[e];var n=i._fieldsByName[e];if(!(n&&n instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(n instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));return this[n.name]},a.$get=a.get;for(var f=0;f<n.length;f++){var h=n[f];h instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")}),t=t.substring(0,1).toUpperCase()+t.substring(1),r=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),n=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},s=function(){return this[e.name]};null===i.getChild("set"+t)&&(a["set"+t]=n),null===i.getChild("set_"+r)&&(a["set_"+r]=n),null===i.getChild("get"+t)&&(a["get"+t]=s),null===i.getChild("get_"+r)&&(a["get_"+r]=s)}(h)}return a.encode=function(t,r){"boolean"==typeof t&&(r=t,t=void 0);var n=!1;t||(t=new e,n=!0);var s=t.littleEndian;try{return i.encode(this,t.LE(),r),(n?t.flip():t).LE(s)}catch(e){throw t.LE(s),e}},o.encode=function(e,t,i){return new o(e).encode(t,i)},a.calculate=function(){return i.calculate(this)},a.encodeDelimited=function(t,r){var n=!1;t||(t=new e,n=!0);var s=(new e).LE();return i.encode(this,s,r).flip(),t.writeVarint32(s.remaining()),t.append(s),n?t.flip():t},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},a.toHex=a.encodeHex,a.toRaw=function(e,t){return r(this,!!e,!!t,this.$type)},a.encodeJSON=function(){return JSON.stringify(r(this,!0,!0,this.$type))},o.decode=function(t,r,n){"string"==typeof r&&(n=r,r=-1),"string"==typeof t?t=e.wrap(t,n?n:"base64"):e.isByteBuffer(t)||(t=e.wrap(t)),n=t.littleEndian;try{var s=i.decode(t.LE(),r);return t.LE(n),s}catch(e){throw t.LE(n),e}},o.decodeDelimited=function(t,r){if("string"==typeof t?t=e.wrap(t,r?r:"base64"):e.isByteBuffer(t)||(t=e.wrap(t)),1>t.remaining())return null;var n=t.offset,s=t.readVarint32();if(t.remaining()<s)return t.offset=n,null;try{var o=i.decode(t.slice(t.offset,t.offset+s).LE());return t.offset+=s,o}catch(e){throw t.offset+=s,e}},o.decode64=function(e){return o.decode(e,"base64")},o.decodeHex=function(e){return o.decode(e,"hex")},o.decodeJSON=function(e){return new o(JSON.parse(e))},a.toString=function(){return i.toString()},Object.defineProperty&&(Object.defineProperty(o,"$options",{value:i.buildOpt()}),Object.defineProperty(a,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:i}),Object.defineProperty(a,"$type",{value:i})),o}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,s=this.children.length;n<s;n++)if(r=this.children[n],r instanceof c||r instanceof l||r instanceof p){if(i.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");i[r.name]=r.build()}else if(r instanceof l.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof l.OneOf||r instanceof d))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=i},h.encode=function(e,t,i){for(var r,n,s=null,o=0,a=this._fields.length;o<a;++o)r=this._fields[o],n=e[r.name],r.required&&null===n?null===s&&(s=r):r.encode(i?n:r.verifyValue(n),t,e);if(null!==s)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+s),e.encoded=t,e;return t},h.calculate=function(e){for(var t,i,r=0,n=0,s=this._fields.length;n<s;++n){if(t=this._fields[n],i=e[t.name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(i,e)}return r},h.decode=function(e,i,n){"number"!=typeof i&&(i=-1);for(var s,o,a,f=e.offset,h=new this.clazz;e.offset<f+i||-1===i&&0<e.remaining();){if(s=e.readVarint32(),o=7&s,a=s>>>3,o===t.WIRE_TYPES.ENDGROUP){if(a!==n)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(n?n+" expected":"not a group")+")");break}if(s=this._fieldsById[a])s.repeated&&!s.options.packed?h[s.name].push(s.decode(o,e)):s.map?(o=s.decode(o,e),h[s.name].set(o[0],o[1])):(h[s.name]=s.decode(o,e),s.oneof&&(o=h[s.oneof.name],null!==o&&o!==s.name&&(h[o]=null),h[s.oneof.name]=s.name));else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:s=e.readVarint32(),e.offset+=s;break;case t.WIRE_TYPES.STARTGROUP:for(;r(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o)}}for(e=0,i=this._fields.length;e<i;++e)if(s=this._fields[e],null===h[s.name])if("proto3"===this.syntax)h[s.name]=s.defaultValue;else{if(s.required)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+s.name),e.decoded=h,e;t.populateDefaults&&null!==s.defaultValue&&(h[s.name]=s.defaultValue)}return h},n.Message=l;var u=function(e,i,r,n,o,a,f,h,u,c){s.call(this,e,i,a),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=o,this.resolvedType=null,this.id=f,this.options=h||{},this.defaultValue=null,this.oneof=u||null,this.syntax=c||"proto2",this.originalName=this.name,this.keyElement=this.element=null,!this.builder.options.convertFieldsToCamelCase||this instanceof l.ExtensionField||(this.name=t.Util.toCamelCase(this.name))},h=u.prototype=Object.create(s.prototype);h.build=function(){this.element=new f(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new f(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=f.defaultFieldValue(this.type)},h.verifyValue=function(e,i){function r(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}i=i||!1;var n=this;if(null===e)return this.required&&r(typeof e,"required"),"proto3"===this.syntax&&this.type!==t.TYPES.message&&r(typeof e,"proto3 field without field presence cannot be null"),null;var s;if(this.repeated&&!i){Array.isArray(e)||(e=[e]);var o=[];for(s=0;s<e.length;s++)o.push(this.element.verifyValue(e[s]));return o}return this.map&&!i?e instanceof t.Map?e:(e instanceof Object||r(typeof e,"expected ProtoBuf.Map or raw object for map field"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&r(typeof e,"no array expected"),this.element.verifyValue(e))},h.hasWirePresence=function(e,i){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return 0<e.length;case t.TYPES.bytes:return 0<e.remaining();case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},h.encode=function(i,r,n){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return r;try{if(this.repeated){var s;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var o=r.offset;for(s=0;s<i.length;s++)this.element.encodeValue(this.id,i[s],r);var a=r.offset-o,f=e.calculateVarint32(a);if(1<f){var h=r.slice(o,r.offset),o=o+(f-1);r.offset=o,r.append(h)}r.writeVarint32(a,o-f)}else for(s=0;s<i.length;s++)r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[s],r)}else this.map?i.forEach(function(i,n,s){s=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,n)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),r.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r.writeVarint32(s),r.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,n,r),r.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,r)},this):this.hasWirePresence(i,n)&&(r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,r))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return r},h.calculate=function(i,r){if(i=this.verifyValue(i),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var n=0;try{if(this.repeated){var s,o;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(n+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s=o=0;s<i.length;s++)o+=this.element.calculateLength(this.id,i[s]);n+=e.calculateVarint32(o),n+=o}else for(s=0;s<i.length;s++)n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,i[s])}else this.map?i.forEach(function(i,r,s){i=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),n+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),n+=e.calculateVarint32(i),n+=i},this):this.hasWirePresence(i,r)&&(n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,i))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return n},h.decode=function(e,i,r){if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){for(e=i.readVarint32(),e=i.offset+e,r=[];i.offset<e;)r.push(this.decode(this.type.wireType,i,!0));return r}if(this.map){var n=f.defaultFieldValue(this.keyType);if(r=f.defaultFieldValue(this.type),e=i.readVarint32(),i.remaining()<e)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+e+" required but got only "+i.remaining());var s=i.clone();for(s.limit=s.offset+e,i.offset+=e;0<s.remaining();)if(i=s.readVarint32(),e=7&i,i>>>=3,1===i)n=this.keyElement.decode(s,e,i);else{if(2!==i)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(s,e,i)}return[n,r]}return this.element.decode(i,e,this.id)},n.Message.Field=u,h=function(e,t,i,r,n,s,o){u.call(this,e,t,i,null,r,n,s,o)},h.prototype=Object.create(u.prototype),n.Message.ExtensionField=h,n.Message.OneOf=function(e,t,i){s.call(this,e,t,i),this.fields=[]};var c=function(e,t,i,r,n){a.call(this,e,t,i,r,n),this.className="Enum",this.object=null};c.getName=function(e,t){for(var i,r=Object.keys(e),n=0;n<r.length;++n)if(e[i=r[n]]===t)return i;return null},(c.prototype=Object.create(a.prototype)).build=function(e){if(this.object&&!e)return this.object;e=new t.Builder.Enum;for(var i=this.getChildren(c.Value),r=0,n=i.length;r<n;++r)e[i[r].name]=i[r].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=e},n.Enum=c,h=function(e,t,i,r){s.call(this,e,t,i),this.className="Enum.Value",this.id=r},h.prototype=Object.create(s.prototype),n.Enum.Value=h;var d=function(e,t,i,r){s.call(this,e,t,i),this.field=r};d.prototype=Object.create(s.prototype),n.Extension=d;var p=function(e,t,i,r){a.call(this,e,t,i,r),this.className="Service",this.clazz=null};(p.prototype=Object.create(a.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(t,i){for(var r=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},n=r.prototype=Object.create(t.Builder.Service.prototype),s=i.getChildren(t.Reflect.Service.RPCMethod),o=0;o<s.length;o++)(function(t){n[t.name]=function(r,n){try{try{r=t.resolvedRequestType.clazz.decode(e.wrap(r))}catch(e){if(!(e instanceof TypeError))throw e}if(null===r||"object"!=typeof r)throw Error("Illegal arguments");r instanceof t.resolvedRequestType.clazz||(r=new t.resolvedRequestType.clazz(r)),this.rpcImpl(t.fqn(),r,function(e,r){if(e)n(e);else{null===r&&(r="");try{r=t.resolvedResponseType.clazz.decode(r)}catch(e){}r&&r instanceof t.resolvedResponseType.clazz?n(null,r):n(Error("Illegal response type received in service method "+i.name+"#"+t.name))}})}catch(e){setTimeout(n.bind(this,e),0)}},r[t.name]=function(e,i,n){new r(e)[t.name](i,n)},Object.defineProperty&&(Object.defineProperty(r[t.name],"$options",{value:t.buildOpt()}),Object.defineProperty(n[t.name],"$options",{value:r[t.name].$options}))})(s[o]);return Object.defineProperty&&(Object.defineProperty(r,"$options",{value:i.buildOpt()}),Object.defineProperty(n,"$options",{value:r.$options}),Object.defineProperty(r,"$type",{value:i}),Object.defineProperty(n,"$type",{value:i})),r}(t,this)},n.Service=p;var g=function(e,t,i,r){s.call(this,e,t,i),this.className="Service.Method",this.options=r||{}};return(g.prototype=Object.create(s.prototype)).buildOpt=o.buildOpt,n.Service.Method=g,o=function(e,t,i,r,n,s,o,a){g.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=r,this.responseName=n,this.requestStream=s,this.responseStream=o,this.resolvedResponseType=this.resolvedRequestType=null},o.prototype=Object.create(g.prototype),n.Service.RPCMethod=o,n}(i),i.Builder=function(e,t,i){function r(e){e.messages&&e.messages.forEach(function(t){t.syntax=e.syntax,r(t)}),e.enums&&e.enums.forEach(function(t){t.syntax=e.syntax})}var n=function(e){this.ptr=this.ns=new i.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},s=n.prototype;return n.isMessage=function(e){return"string"==typeof e.name&&"undefined"==typeof e.values&&"undefined"==typeof e.rpc},n.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&"undefined"!=typeof e.id},n.isEnum=function(e){return!("string"!=typeof e.name||"undefined"==typeof e.values||!Array.isArray(e.values)||0===e.values.length)},n.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},n.isExtend=function(e){return"string"==typeof e.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new i.Namespace(this,this.ptr,e)),this.ptr=t},this),this},s.create=function(t){if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var r=[t];0<r.length;){if(t=r.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;0<t.length;){var s=t.shift();if(n.isMessage(s)){var o=new i.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),a={};s.oneofs&&Object.keys(s.oneofs).forEach(function(e){o.addChild(a[e]=new i.Message.OneOf(this,o,e))},this),s.fields&&s.fields.forEach(function(e){if(null!==o.getChild(0|e.id))throw Error("duplicate or invalid field id in "+o.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+o.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=a[e.oneof]))throw Error("illegal oneof in "+o.name+"#"+e.name+": "+e.oneof);e=new i.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,s.syntax),t&&t.fields.push(e),o.addChild(e)},this);var f=[];if(s.enums&&s.enums.forEach(function(e){f.push(e)}),s.messages&&s.messages.forEach(function(e){f.push(e)}),s.services&&s.services.forEach(function(e){f.push(e)}),s.extensions&&(o.extensions="number"==typeof s.extensions[0]?[s.extensions]:s.extensions),this.ptr.addChild(o),0<f.length){r.push(t),t=f,f=null,this.ptr=o,o=null;continue}f=null}else if(n.isEnum(s))o=new i.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach(function(e){o.addChild(new i.Enum.Value(this,o,e.name,e.id))},this),this.ptr.addChild(o);else if(n.isService(s))o=new i.Service(this,this.ptr,s.name,s.options),Object.keys(s.rpc).forEach(function(e){var t=s.rpc[e];o.addChild(new i.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(o);else{if(!n.isExtend(s))throw Error("not a valid definition: "+JSON.stringify(s));if(o=this.ptr.resolve(s.ref,!0))s.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate extended field id in "+o.name+": "+t.id);if(o.extensions){var r=!1;if(o.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+o.name+": "+t.id+" (not within valid ranges)")}var n=t.name;this.options.convertFieldsToCamelCase&&(n=e.Util.toCamelCase(n));var n=new i.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+"."+n,t.id,t.options),s=new i.Extension(this,this.ptr,t.name,n);n.extension=s,this.ptr.addChild(s),o.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("extended message "+s.ref+" is not defined")}o=s=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s.import=function(t,i){var n="/";if("string"==typeof i){if(e.Util.IS_NODE&&(i=require("path").resolve(i)),!0===this.files[i])return this.reset();this.files[i]=!0}else if("object"==typeof i){var s=i.root;if(e.Util.IS_NODE&&(s=require("path").resolve(s)),(0<=s.indexOf("\\")||0<=i.file.indexOf("\\"))&&(n="\\"),
s=s+n+i.file,!0===this.files[s])return this.reset();this.files[s]=!0}if(t.imports&&0<t.imports.length){var o=!1;"object"==typeof i?(this.importRoot=i.root,o=!0,s=this.importRoot,i=i.file,(0<=s.indexOf("\\")||0<=i.indexOf("\\"))&&(n="\\")):"string"==typeof i?this.importRoot?s=this.importRoot:0<=i.indexOf("/")?(s=i.replace(/\/[^\/]*$/,""),""===s&&(s="/")):0<=i.indexOf("\\")?(s=i.replace(/\\[^\\]*$/,""),n="\\"):s=".":s=null;for(var a=0;a<t.imports.length;a++)if("string"==typeof t.imports[a]){if(!s)throw Error("cannot determine import root");var f=t.imports[a];if("google/protobuf/descriptor.proto"!==f&&(f=s+n+f,!0!==this.files[f])){/\.proto$/i.test(f)&&!e.DotProto&&(f=f.replace(/\.proto$/,".json"));var h=e.Util.fetch(f);if(null===h)throw Error("failed to import '"+f+"' in '"+i+"': file not found");/\.json$/i.test(f)?this.import(JSON.parse(h+""),f):this.import(e.DotProto.Parser.parse(h),f)}}else i?/\.(\w+)$/.test(i)?this.import(t.imports[a],i.replace(/^(.+)\.(\w+)$/,function(e,t,i){return t+"_import"+a+"."+i})):this.import(t.imports[a],i+"_import"+a):this.import(t.imports[a]);o&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&r(t);var l=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){l.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=l),t.enums&&(this.create(t.enums),this.ptr=l),t.services&&(this.create(t.services),this.ptr=l),t.extends&&this.create(t.extends),this.reset()},s.resolveAll=function(){var r;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof i.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof i.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(r=(this.ptr instanceof i.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!r)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=r,r instanceof i.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==r.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(r instanceof i.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=r.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(r=this.ptr.parent.resolve(this.ptr.requestName,!0),!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=r,r=this.ptr.parent.resolve(this.ptr.responseName,!0),!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=r}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},s.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;e="string"==typeof e?e.split("."):e;for(var t=this.result,i=0;i<e.length;i++){if(!t[e[i]]){t=null;break}t=t[e[i]]}return t},s.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},s.toString=function(){return"Builder"},n.Message=function(){},n.Enum=function(){},n.Service=function(){},n}(i,i.Lang,i.Reflect),i.Map=function(e,t){function i(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var r=function(e,i){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),i)for(var r=Object.keys(i),n=0;n<r.length;n++){var s=this.keyElem.valueFromString(r[n]),o=this.valueElem.verifyValue(i[r[n]]);this.map[this.keyElem.valueToString(s)]={key:s,value:o}}},n=r.prototype;return n.clear=function(){this.map={}},n.delete=function(e){e=this.keyElem.valueToString(this.keyElem.verifyValue(e));var t=e in this.map;return delete this.map[e],t},n.entries=function(){for(var e,t=[],r=Object.keys(this.map),n=0;n<r.length;n++)t.push([(e=this.map[r[n]]).key,e.value]);return i(t)},n.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return i(e)},n.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return i(e)},n.forEach=function(e,t){for(var i,r=Object.keys(this.map),n=0;n<r.length;n++)e.call(t,(i=this.map[r[n]]).value,i.key,this)},n.set=function(e,t){var i=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:r},this},n.get=function(e){return e=this.keyElem.valueToString(this.keyElem.verifyValue(e)),e in this.map?this.map[e].value:void 0},n.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},r}(i,i.Reflect),i.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,r)},i.protoFromString=i.loadProto,i.loadProtoFile=function(e,t,r){if(t&&"object"==typeof t?(r=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(n){if(null===n)t(Error("Failed to fetch file"));else try{t(null,i.loadProto(n,r,e))}catch(e){t(e)}});var n=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===n?null:i.loadProto(n,r,e)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return e=e||{},"undefined"==typeof e.convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),"undefined"==typeof e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,r),t.resolveAll(),t},i.loadJsonFile=function(e,t,r){if(t&&"object"==typeof t?(r=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(n){if(null===n)t(Error("Failed to fetch file"));else try{t(null,i.loadJson(JSON.parse(n),r,e))}catch(e){t(e)}});var n=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===n?null:i.loadJson(JSON.parse(n),r,e)},i});var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),sjcl.bitArray={bitSlice:function(e,t,i){return e=sjcl.bitArray.g(e.slice(t/32),32-(31&t)).slice(1),void 0===i?e:sjcl.bitArray.clamp(e,i-t)},extract:function(e,t,i){var r=Math.floor(-t-i&31);return((t+i-1^t)&-32?e[t/32|0]<<32-r^e[t/32+1|0]>>>r:e[t/32|0]>>>r)&(1<<i)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var i=e[e.length-1],r=sjcl.bitArray.getPartial(i);return 32===r?e.concat(t):sjcl.bitArray.g(t,r,0|i,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+sjcl.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var i=e.length;return t&=31,0<i&&t&&(e[i-1]=sjcl.bitArray.partial(t,e[i-1]&2147483648>>t-1,1)),e},partial:function(e,t,i){return 32===e?t:(i?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(sjcl.bitArray.bitLength(e)!==sjcl.bitArray.bitLength(t))return!1;var i,r=0;for(i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r},g:function(e,t,i,r){var n;for(n=0,void 0===r&&(r=[]);32<=t;t-=32)r.push(i),i=0;if(0===t)return r.concat(e);for(n=0;n<e.length;n++)r.push(i|e[n]>>>t),i=e[n]<<32-t;return n=e.length?e[e.length-1]:0,e=sjcl.bitArray.getPartial(n),r.push(sjcl.bitArray.partial(t+e&31,32<t+e?i:r.pop(),1)),r},j:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},sjcl.codec.base32={e:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",fromBits:function(e,t){var i,r="",n=0,s=sjcl.codec.base32.e,o=0,a=sjcl.bitArray.bitLength(e);for(i=0;5*r.length<a;)r+=s.charAt((o^e[i]>>>n)>>>27),5>n?(o=e[i]<<5-n,n+=27,i++):(o<<=5,n-=5);for(;5&r.length&&!t;)r+="=";return r},toBits:function(e){e=e.replace(/\s|=/g,"").toUpperCase();var t,i,r=[],n=0,s=sjcl.codec.base32.e,o=0;for(t=0;t<e.length;t++){if(i=s.indexOf(e.charAt(t)),0>i)throw new sjcl.exception.invalid("this isn't base32!");27<n?(n-=27,r.push(o^i>>>n),o=i<<32-n):(n+=5,o^=i<<32-n)}return 56&n&&r.push(sjcl.bitArray.partial(56&n,o,1)),r}},sjcl.hash.sha1=function(e){e?(this.d=e.d.slice(0),this.b=e.b.slice(0),this.a=e.a):this.reset()},sjcl.hash.sha1.hash=function(e){return(new sjcl.hash.sha1).update(e).finalize()},sjcl.hash.sha1.prototype={blockSize:512,reset:function(){return this.d=this.h.slice(0),this.b=[],this.a=0,this},update:function(e){"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e));var t,i=this.b=sjcl.bitArray.concat(this.b,e);for(t=this.a,e=this.a=t+sjcl.bitArray.bitLength(e),t=this.blockSize+t&-this.blockSize;t<=e;t+=this.blockSize)n(this,i.splice(0,16));return this},finalize:function(){var e,t=this.b,i=this.d,t=sjcl.bitArray.concat(t,[sjcl.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.a/4294967296)),t.push(0|this.a);t.length;)n(this,t.splice(0,16));return this.reset(),i},h:[1732584193,4023233417,2562383102,271733878,3285377520],i:[1518500249,1859775393,2400959708,3395469782]},sjcl.misc.hmac=function(e,t){this.f=t=t||sjcl.hash.sha256;var i,r=[[],[]],n=t.prototype.blockSize/32;for(this.c=[new t,new t],e.length>n&&(e=t.hash(e)),i=0;i<n;i++)r[0][i]=909522486^e[i],r[1][i]=1549556828^e[i];this.c[0].update(r[0]),this.c[1].update(r[1])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(e){return e=new this.f(this.c[0]).update(e).finalize(),new this.f(this.c[1]).update(e).finalize()},define("sjcl",function(e){return function(){var t;return t||e.sjcl}}(this)),define("Utils",["protobuf","sjcl"],function(e,t){return Date.prototype.Format=function(e){var t=e,i=["","","","","","",""];return t=t.replace(/yyyy|YYYY/,this.getFullYear()),t=t.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100),t=t.replace(/MM/,this.getMonth()>9?this.getMonth().toString():"0"+this.getMonth()),t=t.replace(/M/g,this.getMonth()),t=t.replace(/w|W/g,i[this.getDay()]),t=t.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate()),t=t.replace(/d|D/g,this.getDate()),t=t.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours()),t=t.replace(/h|H/g,this.getHours()),t=t.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes()),t=t.replace(/m/g,this.getMinutes()),t=t.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds()),t=t.replace(/s|S/g,this.getSeconds()),t=t.replace(/u|U/g,(this.getMilliseconds()/1e3+"00000").substring(2,5))},{enumMap:{},EnumMapRegister:function(e,t){this.enumMap[t]={collection:e,reverse:[]};for(var i in e)this.enumMap[t].reverse[e[i]]=i},EnumGetKey:function(e,t){var i=this.enumMap[e].reverse[t];return void 0===i?i:i.replace(e,"")},EnumGetValue:function(e,t){return this.enumMap[e].collection[(e+t).toUpperCase()]},now:function(){return(new Date).Format("HH:mm:ss.u")},containGetKey:function(e,t){for(var i in e)if(e[i]==t)return i;return!1},extend:function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.uber=t.prototype},extendOptions:function(e,t){for(var i in t)if("function"!=typeof t[i])if(t[i]instanceof Object)for(var r in t[i])if("function"!=typeof t[i][r])if(t[i][r]instanceof Object)for(var n in t[i][r])e[i]=e[i]?e[i]:{},e[i][r]=e[i][r]?e[i][r]:{},e[i][r][n]=t[i][r][n];else e[i]=e[i]?e[i]:{},e[i][r]=t[i][r];else e[i][r]=t[i][r];else e[i]=t[i];else e[i]=t[i];return e},getSequence:function(){for(var e=""+Math.floor(1e3*Math.random());e.length<3;)e="0"+e;var t=this.timestamp()+"";return t.substring(0,3)+t.substring(6)+e},timestamp:function(){return parseInt((new Date).valueOf()/1e3)},loadProtoFile:function(t){var i=e.loadProtoFile(t);return i.build()},loadProtoString:function(t){var i=e.loadProto(t);return i.build()},ten2sixteen:function(e){return[e>>8,255&e]},hex2IntArray:function(e){e.length%2&&(e+="0");for(var t=[],i=0;i<e.length;i+=2){var r=e.substr(i,2);t[i/2]=parseInt(r,16)}return t},intArray2HexStr:function(e){for(var t="",i=0;i<e.length;i++){var r=parseInt(e[i]).toString(16);1==r.length&&(r="0"+r),t+=r}return t},base64decode2ArrayBuffer:function(e){var t=CryptoJS.enc.Base64.parse(e),i=CryptoJS.enc.Hex.stringify(t),r=this.hex2IntArray(i),n=new Uint8Array(r);return n},AESEncrypt:function(e,t,i){var r=CryptoJS.MD5(t),t=CryptoJS.enc.Utf8.parse(r),i=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.AES.encrypt(e,t,{iv:i,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding});return n},AESDecrypt:function(e,t,i){var r=CryptoJS.MD5(t),t=CryptoJS.enc.Utf8.parse(r),i=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.AES.decrypt(e,t,{iv:i,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding});return n},SecretEncrpt:function(e,t){return t=this.base32_encode(t),this.HOTP(t,Math.floor(this.timestamp()/30))},getOptionOrDefault:function(e,t,i){return e?void 0===e[t]?i:e[t]:i},HOTP:function(e,i){for(var r=t.codec.base32.toBits(e),n=[(0xffffffff00000000&i)>>32,4294967295&i],s=6,o=new t.misc.hmac(r,t.hash.sha1),a=o.encrypt(n),f=15&t.bitArray.extract(a,152,8),h=8*f,l=h+32,u=t.bitArray.bitSlice(a,h,l),c=u[0],d=2147483647&c,p=d%Math.pow(10,s),g=p.toString();g.length<s;)g="0"+g;return g},base32_encode:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",i=e.length,r="",n=0,s=0,o=0;o<i;o++){for(var a=e.charCodeAt(o),f=n<<8|a,h=s+8;h>=5;)r+=t.charAt(f>>h-5),h-=5,f&=Math.pow(2,h)-1;n=f,s=h}return s>0&&(n<<=5-s,r+=t.charAt(n)),r},array_reverse:function(e){var t=[];for(var i in e)t[e[i]]=i;return t},ajax:function(e){e=e||{},e.type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=void 0===e.async||e.async;var t=this.formatParams(e.data);if(window.XMLHttpRequest)var i=new XMLHttpRequest;else var i=new ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4==i.readyState){var t=i.status;if(t>=200&&t<300)if("json"==e.dataType){var r=!1;try{var r=JSON.parse(i.responseText)}catch(e){r=!1}!1===r?e.success&&e.success(i.responseText,i.responseXML):e.success&&e.success(r,i)}else e.success&&e.success(i.responseText,i.responseXML);else e.fail&&e.fail(t)}},"GET"==e.type?(i.open("GET",e.url+"?"+t,e.async),i.send(null)):"POST"==e.type&&(i.open("POST",e.url,e.async),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(t))},formatParams:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")},validateCallback:function(e){return void 0!==e&&"function"==typeof e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},fireFunction:function(e,t){return!(!e||!this.isFunction(e))&&e.apply("",t)},array_get:function(e,t,i){var r,n=e;r="object"==typeof t&&t instanceof Array?t:t.indexOf(".")!=-1?t.split("."):[t];for(var s in r){if(void 0==n[r[s]])return i;n=n[r[s]]}return n}}}),define("logger",["Utils"],function(e){return{logLevel:"debug",setLevel:function(e){this.logLevel=e},debug:function(){this.log("debug",arguments)},info:function(){this.log("info",arguments)},notice:function(){this.log("notice",arguments)},warning:function(){this.log("warning",arguments)},error:function(){this.log("error",arguments)},levelCompare:function(e,t){var i={debug:1,info:2,notice:3,warning:4,error:5};return!(!i[t]||!i[e])&&i[t]>=i[e]},log:function(t,i){if(i.length>0&this.levelCompare(this.logLevel,t)){var r,n={debug:"grey",info:"green",notice:"blue",warning:"orange",error:"red"},s="%c["+e.now()+"] "+t+":";r=new Array,r.push(s),r.push("font-weight:bold;color: "+n[t]);for(var o in i)r.push(i[o]);return console.log.apply(console,r)}}}}),define("event",["Utils"],function(e){var t=function(){this.handlers={},this.evtRet={}};t.prototype={addHandler:function(e,t,i){"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push({handler:t,options:i})},fire:function(e,t){if(this.handlers[e]instanceof Array){var i,r=this.handlers[e],n=null;for(r.reverse();(i=r.pop())&&(n=i.handler.apply(null,t),!1!==n););this.evtRet[e]=n}},clearHandler:function(e){this.handlers[e]instanceof Array&&(this.handlers[e]=[])},removeHandler:function(e,t){if(this.handlers[e]instanceof Array){for(var i=this.handlers[e],r=0,n=i.length;r<n&&i[r]!==t;r++);i.splice(r,1)}}};var i=new t;return i}),define("protocolStruct",["Utils"],function(e){var t=e.loadProtoString('syntax="proto3";package com.scentrealm;enum SrCmdId {SCI_CMD_NONE = 0;SCI_REQ_SLEEP = 10001;SCI_REQ_WAKEUP = 10002;SCI_REQ_USEDSECONDS = 10003;SCI_REQ_PLAYSMELL = 10004;SCI_REQ_GETDEVATTR = 10005;SCI_REQ_SETDEVATTR = 10006;SCI_REQ_DEVICE_MODEL = 10007;SCI_REQ_STOP_PLAY = 10008;SCI_REQ_REMOVE_TASK = 10009;SCI_REQ_SET_CONTROL_ATTR = 10010;SCI_REQ_DEV_WIFI_LIST = 10011;SCI_REQ_SET_DEV_WIFI = 10012;SCI_REQ_WIFI_CONN_REPORT = 10013;SCI_REQ_NET_CONN_REPORT = 10014;SCI_RESP_SLEEP = 20001;SCI_RESP_WAKEUP = 20002;SCI_RESP_USEDSECONDS = 20003;SCI_RESP_PLAYSMELL = 20004;SCI_RESP_GETDEVATTR = 20005;SCI_RESP_SETDEVATTR = 20006;SCI_RESP_DEVICE_MODEL = 20007;SCI_RESP_STOP_PLAY = 20008;SCI_RESP_REMOVE_TASK = 20009;SCI_RESP_SET_CONTROL_ATTR = 20010;SCI_RESP_DEV_WIFI_LIST = 20011;SCI_RESP_SET_DEV_WIFI = 20012;SCI_RESP_WIFI_CONN_REPORT = 20013;SCI_RESP_NET_CONN_REPORT = 20014;SCI_PUSH = 30000;}enum SrErrorCode {SEC_NONE = 0;SEC_SUCCESS = 1;SEC_ACCEPT = 2;SEC_ERROR = -1;SEC_REJECT = -2;}message BaseResponse {SrErrorCode code = 1 ;string msg = 2;}message BaseRequest {}message UsedTimeResponse {message UsedTime {string bottle = 1 ;int32 time = 2;}BaseResponse response = 1 ;repeated UsedTime used_time = 2;}enum SrTimeMode {STM_NONE = 0;STM_RELATIVE = 1;STM_ABSOLUTE = 2;STM_DAYTIME = 3;STM_WEEKDAY = 4;STM_MONTHDAY = 5;STM_MONTH = 6;STM_YEAR = 7;}enum SrCycleMode {SCM_NONE = 0;SCM_CYCLE_NO = 1;SCM_CYCLE_YES = 2;SCM_CYCLE_INFINITE = 3;}message TimePoint {SrTimeMode mode = 1;int32 value = 2;int32 end_value = 3;}message PlayRequest {message PlayAction {string bottle = 1;int32 duration = 2;int32 power = 3;}message PlayTrace {repeated int32 action_id = 1;int32 before_start = 2;SrCycleMode cycle_mode = 3;int32 interval = 4;int32 cycle_time = 5;}BaseRequest request = 1 ;SrCycleMode cycle_mode = 2;repeated TimePoint start_at = 3;int32 cycle_time = 4;repeated PlayAction actions = 5 ;repeated PlayTrace trace = 6 ;}message StopPlayRequest {BaseRequest request = 1;repeated string bottles = 2;}enum SrRemoveTaskMode{SRT_NONE = 0;SRT_STOP_CANCEL = 1;SRT_STOP_NOTCANCEL = 2;SRT_NOTSTOP_CANCEL = 3;}message RemoveTaskRequest {BaseRequest request = 1;message RemoveTaskOption {int32 stop_seq = 1;SrRemoveTaskMode mode = 2;}repeated RemoveTaskOption stop_tasks = 2;}enum SrDevAttrType {SDST_NONE = 0;SDST_DEVICEID = 1;SDST_DEVICENAME = 2;SDST_DEVICETYPE = 3;SDST_MAC = 4;SDST_WIFISSID = 5;SDST_WIFIPWD = 6;SDST_NETCONNECTSTATE = 7;SDST_BLECONNECTSTATE = 8;SDST_LOGSTATE = 9;SDST_DATETIME = 10;SDST_UPTIME = 11;SDST_DOWNTIME = 12;}message DevAttrOption {SrDevAttrType attr = 1;string value = 2;}message GetDevAttrsRequest {BaseRequest request = 1 ;repeated SrDevAttrType attrs = 2;}message GetDevAttrsResponse {BaseResponse response = 1 ;repeated DevAttrOption attrs = 2;}message SetDevAttrsRequest {BaseRequest request = 1 ;repeated DevAttrOption attrs = 2;}message DeviceModelResponse {BaseResponse response = 1;repeated SrCmdId support_cmds = 2;repeated AppControlSet controls = 3;}message AppControlSet {int32 identity = 1;string name = 2;oneof controller {AppControlSwitch switch = 11;AppControlSlider slider = 12;AppControlSpin spin = 13;AppControlSwitchSlider switch_slider = 14;}}enum SrSwitchStatus {SSS_NONE = 0;SSS_ON = 1;SSS_OFF = 2;}message AppControlSwitch {SrSwitchStatus status = 1;}message AppControlSlider {int32 _min = 1;int32 _max = 2;int32 _step = 3;int32 value = 4;}message AppControlSpin {int32 _step = 1;int32 angle = 2;int32 angular_speed = 3;}message AppControlSwitchSlider {SrSwitchStatus status = 1;int32 _min = 2;int32 _max = 3;int32 _step = 4;int32 value = 5;}message SetControlAttrRequest {message SetControlAttr {int32 identity = 1;string attr = 2;string value = 3;}BaseRequest request = 1;repeated SetControlAttr settings = 2;}message DevWifiListResponse {BaseResponse response = 1;repeated string wifissid_list = 2;}message SetDevWifiRequest {string wifissid = 1;string wifipwd = 2;}'),i=t.com.scentrealm;return i}),define("device",["protocolStruct"],function(e){var t={attrs:{DEVICEID:"TCEOP0GZZRWHAMOOA3MM",DEVICENAME:"0001",DEVICETYPE:"T1000",DEVICESTATUS:"AWAKE",MAC:"F8-A9-63-57-0F-CE",WIFISSID:"RENRENWIFI",WIFIPWD:"RENREN2016",NETCONNECTSTATE:"OFF",BLECONNECTSTATE:"OFF",LOGSTATE:"OFF",DATETIME:"2016-10-25 12:12:12",UPTIME:"2016-10-25 12:12:12",DOWNTIME:"2016-10-25 12:12:12"},attrsName:{DEVICEID:"",DEVICENAME:"",DEVICETYPE:"",DEVICESTATUS:"",MAC:"MAC ",WIFISSID:"WIFISSID",WIFIPWD:"WIFI",NETCONNECTSTATE:"",BLECONNECTSTATE:"",LOGSTATE:"",DATETIME:"",UPTIME:"",DOWNTIME:""},bottles:[{bottle:"000000001",time:1},{bottle:"000000002",time:2},{bottle:"000000003",time:3},{bottle:"000000004",time:3},{bottle:"000000005",time:3},{bottle:"000000006",time:3},{bottle:"000000007",time:3},{bottle:"000000008",time:3},{bottle:"000000009",time:3},{bottle:"000000010",time:3}],model:{support_cmds:[e.SrCmdId.SCI_REQ_SLEEP,e.SrCmdId.SCI_REQ_WAKEUP,e.SrCmdId.SCI_REQ_USEDSECONDS,e.SrCmdId.SCI_REQ_PLAYSMELL,e.SrCmdId.SCI_REQ_GETDEVATTR,e.SrCmdId.SCI_REQ_SETDEVATTR,e.SrCmdId.SCI_REQ_DEVICE_MODEL,e.SrCmdId.SCI_REQ_STOP_PLAY,e.SrCmdId.SCI_REQ_REMOVE_TASK,e.SrCmdId.SCI_REQ_SET_CONTROL_ATTR],controls:[{identity:1,name:"AppControlSwitch",switch:{status:e.SrSwitchStatus.SSS_OFF}},{identity:2,name:"AppControlSlider",slider:{_min:1,_max:10,_step:2,value:2}},{identity:3,name:"AppControlSpin",spin:{angle:22,_step:1,angular_speed:1}},{identity:4,name:"AppControlSwitchSlider",switch_slider:{status:e.SrSwitchStatus.SSS_ON,_min:1,_max:10,_step:2,value:2}}]},getUsedTime:function(){return this.bottles},getModel:function(){return this.model},getAttr:function(e){return!!this.attrs[e]&&this.attrs[e]},setAttr:function(e,t){return void 0!=this.attrs[e]&&(this.attrs[e]=t,!0)},actions:{netConnect:function(){console.log("--netConnect--")},playSmell:function(e){console.log("--playSmell--")},sleep:function(){t.attrs.DEVICESTATUS="SLEEP",console.log("--sleep--")},wakeup:function(){t.attrs.DEVICESTATUS="AWAKE",console.log("--wakeup--")},setControlAttr:function(e){var i={},r=0;for(var n in e.settings)i["id-"+e.settings[n].identity]||(i["id-"+e.settings[n].identity]={}),i["id-"+e.settings[n].identity][e.settings[n].attr]=e.settings[n].value,r++;for(var n in t.model.controls){var s=t.model.controls[n].identity;if(void 0!==i["id-"+s]){var o="slider";for(var a in t.model.controls[n])if("identity"!==a&&"name"!==a){o=a;break}for(var f in i["id-"+s])if("name"!==f){var h=t.model.controls[n][o][f];if(void 0!==h){var l=i["id-"+s][f];"number"==typeof h?l=parseInt(l):"string"==typeof h?l+="":"boolean"==typeof h&&(l="true"===l||"false"!==l&&parseInt(l)>0),t.model.controls[n][o][f]=l,console.log("identity = "+s+" attr = "+f+" ["+h+" => "+l+"]"),r--}else console.log("Attr Not Found  "+f)}else t.model.controls[n][f]=i["id-"+s][f];delete i["id-"+s]}}if(console.log(i),console.log(e),console.log("--setControlAttr--"),r>0){console.log("--Identity Can Not Found List--");for(var n in i)console.log(n,i[n]);console.log("--END List--")}return r}}};return t}),define("msgHandler",["device"],function(e){var t=function(t){var i=t.utils,r=t.logger,n=t.protoRoot,s={SCI_REQ_SLEEP:function(i,r){t.logger.debug("Got SCI_REQ_SLEEP");var s=new n.BaseResponse(n.SrErrorCode.SEC_SUCCESS,"SCI_req_sleep");t.sendCmdResp(i.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_SLEEP,s),e.actions.sleep()},SCI_REQ_WAKEUP:function(i,r){t.logger.debug("Got SCI_REQ_WAKEUP");var s=new n.BaseResponse(n.SrErrorCode.SEC_SUCCESS,"SCI_req_wakeup");t.sendCmdResp(i.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_WAKEUP,s),e.actions.wakeup()},SCI_REQ_USEDSECONDS:function(i,r){var s=e.getUsedTime(),o=new n.UsedTimeResponse({response:{code:n.SrErrorCode.SEC_SUCCESS,msg:"SCI_req_setDevAttr"},used_time:s});t.sendCmdResp(i.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_USEDSECONDS,o)},SCI_REQ_PLAYSMELL:function(t,i,r){var s=r.decodePayload(t,i.payloadBytes);r.logger.info("SCI_req_playSmell",s);var o=new n.BaseResponse({code:n.SrErrorCode.SEC_ACCEPT,msg:"SCI_req_setDevAttr"});r.sendCmdResp(t.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_PLAYSMELL,o),e.actions.playSmell(s)},SCI_REQ_GETDEVATTR:function(t,i,r){var s=r.decodePayload(t,i.payloadBytes),o=[];for(var a in s.attrs){var f=r.utils.EnumGetKey("SDST_",s.attrs[a]);o.push({attr:s.attrs[a],value:e.getAttr(f)})}var h=new n.GetDevAttrsResponse({attrs:o});r.sendCmdResp(t.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_GETDEVATTR,h)},SCI_REQ_SETDEVATTR:function(t,i,r){var s=r.decodePayload(t,i.payloadBytes);r.logger.info("decode Obj",s);for(var o in s.attrs){var a=r.utils.EnumGetKey("SDST_",s.attrs[o].attr),f=e.setAttr(a,s.attrs[o].value);r.logger.info("decode attrName,ret",a,f)}var h=new n.BaseResponse({code:n.SrErrorCode.SEC_SUCCESS,msg:"SCI_req_setDevAttr"});r.sendCmdResp(t.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_SETDEVATTR,h)},SCI_REQ_DEVICE_MODEL:function(t,i,r){var s=(n.SrCmdId,e.getModel());s.response={code:n.SrErrorCode.SEC_SUCCESS,msg:"SCI_REQ_DEVICE_MODEL"},r.logger.debug("model data",s);var o=new n.DeviceModelResponse(s);r.sendCmdResp(t.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_DEVICE_MODEL,o)},SCI_REQ_STOP_PLAY:function(e,t,i){var r=(i.decodePayload(e,t.payloadBytes),new n.BaseResponse({code:n.SrErrorCode.SEC_SUCCESS,msg:"SCI_REQ_STOP_PLAY"}));i.sendCmdResp(e.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_STOP_PLAY,r)},SCI_REQ_REMOVE_TASK:function(e,t,i){var r=(i.decodePayload(e,t.payloadBytes),new n.BaseResponse({code:n.SrErrorCode.SEC_SUCCESS,msg:"SCI_REQ_REMOVE_TASK"}));i.sendCmdResp(e.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_REMOVE_TASK,r)},SCI_REQ_SET_CONTROL_ATTR:function(t,i,r){var s=r.decodePayload(t,i.payloadBytes),o=new n.BaseResponse({code:n.SrErrorCode.SEC_ACCEPT,msg:"SCI_REQ_SET_CONTROL_ATTR"});console.log(o),r.sendCmdResp(t.SEQUENCE_NUMBER,n.SrCmdId.SCI_RESP_SET_CONTROL_ATTR,o),e.actions.setControlAttr(s)}};return{onConnect:function(){var e=t.getEssentialConfig("accessKey");r.info("onConnect,clientId = "+e);var i="/"+e;t.subscribe(i),t.subscribedThen(i,function(){var e="self-confirm";t.publish(i,new Uint8Array([255])),t.evt.addHandler(e,function(){t.setConnected(),t.evt.fire("onServerConnect",[t])});var r=setTimeout(function(){t.logger.error("self-confirm failed"),t.disconnect(),t.connect()},1e3);t.evt.addHandler(e,function(){clearTimeout(r)})})},onConnectionLost:function(e){r.info("onConnectionLost",e),0!==e.errorCode&&r.info("onConnectionLost:"+e.errorMessage)},onMessageDelivered:function(e){r.info("onMessageDelivered.payloadBytes "+e.destinationName,e.payloadBytes)},onMessageArrived:function(e){r.info("onMessageArrived From Topic "+e.destinationName);var n=t.analyzeHeader(e.payloadBytes);if(!1===n)r.debug("Header Not Match"),r.debug("PayloadBytes",e.payloadBytes),1==e.payloadBytes.length&&255==e.payloadBytes[0]&&(r.info("self-confirm found"),t.evt.fire("self-confirm",[]));else{r.debug("Header Found",n);var o="SCI_",a=i.EnumGetKey(o,n.COMMAND_ID);r.info("Got SrCmdId ",a),void 0!=a&&void 0!=s[o+a]?s[o+a].apply(null,[n,e,t]):r.warning("SrCmdId Not Match",a)}}}};return t}),define("CmdApi",[],function(){var e=function(e,t,i){var r=(e.utils,e.logger,e.protoRoot),n=r.SrCmdId,s=r.SrDevAttrType,o={timeout:4};if(i)for(var a in i)o[a]=i[a];deviceID=t;var f=function(e){e.logger.error('Failed to use device "'+t+'"')},h=function(e){e.logger.debug('Success to use device "'+t+'"')};return e.logger.debug('Attrmpt to Connect "'+t+'"'),o.onFailure&&e.utils.isFunction(o.onFailure)&&(f=o.onFailure),o.onSuccess&&e.utils.isFunction(o.onSuccess)&&(h=o.onSuccess),o.responseTopic="/"+deviceID+"/resp",e.evt.addHandler("onSubscribedFailure-"+o.responseTopic,function(e){f(e)}),e.evt.addHandler("onSubscribed-"+o.responseTopic,function(e){h(e)}),e.connectedThen(function(){e.subscribe(o.responseTopic)}),{deviceID:deviceID,options:o,getOption:function(t){return e.utils.getOptionOrDefault(this.options,t,void 0)},disconnect:function(){var t=this.getOption("responseTopic");e.isSubscribed(t)&&e.unsubscribe(t)},setCallback:function(t,i,r,n,s){var o=i+"/"+r,a=function(){},f=e.utils.validateCallback(n)?n:a,h=e.utils.validateCallback(s)?s:a,l={msg:"Response Decode Error",type:"ResponseDecodeError"},u=function(e,i,r){var n=null;return e.BODY_LENGTH>0&&(n=r.decodePayload(e,i.payloadBytes)),!1===n?(r.logger.error("Response Data Decode Error"),void h(l,r)):(r.logger.info("reqCmd,header,message,decode",t,e,i,n),void(f&&f(e.SEQUENCE_NUMBER,n,r)))};e.logger.debug("eventSeq",o),e.evt.addHandler(o,u);var c=setTimeout(function(){e.logger.error("req "+t+" seq "+r+" timeout"),l={msg:"Respones Time Out",type:"ResponesTimeOut"},h(l,e)},1e3*this.getOption("timeout"));return e.evt.addHandler(o,function(){clearTimeout(c)}),!0},invokeApi:function(t){var i=this.getOption("responseTopic"),r=this;return e.subscribedThen(i,function(){reqData=t.dataPacking();var i=e.getEssentialConfig("protobuf.listenCmdMap"),n=e.sendCmd2Dev(deviceID,t.reqCmdID,reqData);r.setCallback(t.reqCmdID,i[t.reqCmdID],n,t.onSuccess,t.onError)}),!0},sleep:function(e,t){return this.invokeApi({reqCmdID:n.SCI_REQ_SLEEP,dataPacking:function(){return[]},onSuccess:e,onError:t})},wakeup:function(e,t){return this.invokeApi({reqCmdID:n.SCI_REQ_WAKEUP,dataPacking:function(){return[]},onSuccess:e,onError:t})},usedSeconds:function(e,t){return this.invokeApi({reqCmdID:n.SCI_REQ_USEDSECONDS,dataPacking:function(){return[]},onSuccess:e,onError:t})},playSmell:function(e,t,i){return this.invokeApi({reqCmdID:n.SCI_REQ_PLAYSMELL,dataPacking:function(){return e instanceof r.PlayRequest==!1&&"object"==typeof e&&(e=new r.PlayRequest(e)),e},onSuccess:t,onError:i})},getDevAttr:function(t,i,o){return this.invokeApi({reqCmdID:n.SCI_REQ_GETDEVATTR,dataPacking:function(){t=t||[s.SDST_DEVICEID,s.SDST_DEVICENAME,s.SDST_DEVICETYPE];for(var i in t)/\d+/.test(t[i])||(t[i]=e.utils.EnumGetValue("SDST_",t[i]));var n=new r.GetDevAttrsRequest({attrs:t});return n},onSuccess:i,onError:o})},setDevAttr:function(t,i,s){return this.invokeApi({reqCmdID:n.SCI_REQ_SETDEVATTR,dataPacking:function(){var i=[];for(var n in t)/\d+/.test(n)?i.push({attr:n,value:t[n]}):i.push({attr:e.utils.EnumGetValue("SDST_",n),value:t[n]});var s=new r.SetDevAttrsRequest({attrs:i});return s},onSuccess:i,onError:s})},deviceModelReport:function(e,t){return this.invokeApi({reqCmdID:n.SCI_REQ_DEVICE_MODEL,
dataPacking:function(){return[]},onSuccess:e,onError:t})},stopPlay:function(e,t,i){return this.invokeApi({reqCmdID:n.SCI_REQ_STOP_PLAY,dataPacking:function(){var t={bottles:e};return new r.StopPlayRequest(t)},onSuccess:t,onError:i})},removeTask:function(e,t,i){return this.invokeApi({reqCmdID:n.SCI_REQ_REMOVE_TASK,dataPacking:function(){var t={stop_tasks:e};return new r.RemoveTaskRequest(t)},onSuccess:t,onError:i})},setControlAttr:function(e,t,i){return this.invokeApi({reqCmdID:n.SCI_REQ_SET_CONTROL_ATTR,dataPacking:function(){var t={settings:e};return new r.SetControlAttrRequest(t)},onSuccess:t,onError:i})}}};return e}),define("SDK",["Paho","Utils","logger","event","msgHandler","protocolStruct","CmdApi"],function(e,t,i,r,n,s,o){var a={defaults:{accessKey:"accessKey",accessSecret:"accessSecret",logLevel:"error",mqtt:{basepath:"http://open.smell.com/",hostname:"120.26.109.169",port:"8083"},event:{onSuccess:function(){},onFailure:function(){},onConnectionLost:function(){}},maxConnectAttampt:5,protobuf:{headerLength:10,headerStruct:{MAGIC_NUMBER:1,VERSION:1,BODY_LENGTH:2,COMMAND_ID:2,SEQUENCE_NUMBER:4},headerData:{MAGIC_NUMBER:254,VERSION:1},decodeClassMap:{},listenCmdMap:{}}},decreaseConnectAttampt:function(){this.configs.maxConnectAttampt--},getEssentialConfig:function(e,t){var i=this.getConfig(e,t);if(void 0==i)throw Error("Essential Config Not Found("+e+")");return i},getConfig:function(e,t){var i,r=this.configs;if(void 0==e)return r;i=e.indexOf(".")!=-1?e.split("."):[e];for(var n in i){if(void 0==r[i[n]])return t;r=r[i[n]]}return r},loadConfigs:function(e){this.configs=this.defaults;for(var t in e)if(e[t]instanceof Object)for(var i in e[t])this.configs[t][i]=e[t][i];else this.configs[t]=e[t]},client:null,configs:null,evt:null,utils:null,logger:null,protoRoot:null,serverConnected:!1,subscribeArray:{},initProtocolConfig:function(){var e={},t={},i=s.SrCmdId;e[i.SCI_RESP_USEDSECONDS]=s.UsedTimeResponse,e[i.SCI_REQ_PLAYSMELL]=s.PlayRequest,e[i.SCI_REQ_GETDEVATTR]=s.GetDevAttrsRequest,e[i.SCI_RESP_GETDEVATTR]=s.GetDevAttrsResponse,e[i.SCI_REQ_SETDEVATTR]=s.SetDevAttrsRequest,e[i.SCI_RESP_DEVICE_MODEL]=s.DeviceModelResponse,e[i.SCI_REQ_STOP_PLAY]=s.StopPlayRequest,e[i.SCI_REQ_REMOVE_TASK]=s.RemoveTaskRequest,e[i.SCI_REQ_SET_CONTROL_ATTR]=s.SetControlAttrRequest,this.configs.protobuf.decodeClassMap=e,t[i.SCI_REQ_SLEEP]=i.SCI_RESP_SLEEP,t[i.SCI_REQ_WAKEUP]=i.SCI_RESP_WAKEUP,t[i.SCI_REQ_USEDSECONDS]=i.SCI_RESP_USEDSECONDS,t[i.SCI_REQ_PLAYSMELL]=i.SCI_RESP_PLAYSMELL,t[i.SCI_REQ_GETDEVATTR]=i.SCI_RESP_GETDEVATTR,t[i.SCI_REQ_SETDEVATTR]=i.SCI_RESP_SETDEVATTR,t[i.SCI_REQ_DEVICE_MODEL]=i.SCI_RESP_DEVICE_MODEL,t[i.SCI_REQ_STOP_PLAY]=i.SCI_RESP_STOP_PLAY,t[i.SCI_REQ_REMOVE_TASK]=i.SCI_RESP_REMOVE_TASK,t[i.SCI_REQ_SET_CONTROL_ATTR]=i.SCI_RESP_SET_CONTROL_ATTR,this.configs.protobuf.listenCmdMap=t},initialize:function(e){this.loadConfigs(e),this.initProtocolConfig(),this.evt=r,this.utils=t,this.logger=i,this.logger.setLevel(this.getEssentialConfig("logLevel")),this.protoRoot=s,this.utils.EnumMapRegister(s.SrCmdId,"SCI_"),this.utils.EnumMapRegister(s.SrDevAttrType,"SDST_"),this.utils.EnumMapRegister(s.SrFeatureType,"SFT_"),this.utils.EnumMapRegister(s.SrFeatureAttrType,"SFAT_")},connect:function(r){if(this.initialize(r),!(this.getEssentialConfig("maxConnectAttampt")>0))throw Error("Reach Max Connect Attampt,Connect Failed");this.decreaseConnectAttampt();var s=this.getEssentialConfig();i.debug("SDK Config",s),this.client=new e.MQTT.Client(s.mqtt.hostname,Number(s.mqtt.port),s.accessKey);var o=new n(this);this.client.onConnectionLost=o.onConnectionLost,this.client.onMessageArrived=o.onMessageArrived,this.client.onMessageDelivered=o.onMessageDelivered;var a=this.getEssentialConfig("event.onFailure"),f=this.getEssentialConfig("event.onSuccess"),h=a&&t.isFunction(a)?a:function(){i.error("Connect Error",arguments)},l=f&&t.isFunction(f)?f:function(){};this.evt.addHandler("onServerConnect",l);var u=this,c=function(e){u.evt.clearHandler("onServerConnect"),h(e,u)};return this.client.connect({onSuccess:o.onConnect,onFailure:c,userName:s.accessKey,password:t.SecretEncrpt(s.accessKey,s.accessSecret)}),this},connectedThen:function(e){this.isConnected()?e(this):this.evt.addHandler("onServerConnect",e)},disconnect:function(){this.client.disconnect()},setConnected:function(){this.serverConnected=!0},isConnected:function(){return this.serverConnected},usingDevice:function(e,t){return new o(this,e,t)},bindDevice:function(e,i,r){var n={onSuccess:function(){console.log("onSuccess")},onFailure:function(){console.log("onFailure")}};n=t.extendOptions(n,r),console.log("defaultOptions",n);var s=this,o=s.getEssentialConfig("mqtt.basepath"),a=s.getEssentialConfig("accessKey"),f=s.getEssentialConfig("accessSecret");s.utils.ajax({url:o+"api/mqtt/bindDevice",async:!1,data:{developer_access:a,developer_pass:s.utils.SecretEncrpt(a,f),device_name:e,device_pass:s.utils.SecretEncrpt("",i)},success:function(e){return s.logger.info(e),1==e.code?(t.fireFunction(n.onSuccess,[e,s]),!0):(t.fireFunction(n.onFailure,[e,s]),void(errorMsg=e.msg))},error:function(e){return s.logger.error(e),t.fireFunction(n.onFailure,[s]),!1}})},publish:function(i,r,n){var s=new e.MQTT.Message(r);s.destinationName=i,s.qos=t.getOptionOrDefault(n,"qos",1),s.retained=t.getOptionOrDefault(n,"retained",!1),this.logger.debug("publish "+i),this.client.send(s)},subscribe:function(e){var t=this;this.logger.debug("subscribe "+e),this.client.subscribe(e,{qos:1,invocationContext:{topic:e},onSuccess:function(e){t.logger.debug("subscribe onSuccess "+e.invocationContext.topic),t.setSubscribed(e.invocationContext.topic),t.evt.fire("onSubscribed-"+e.invocationContext.topic,[t])},onFailure:function(e){t.logger.error("subscribe onFailure "+e.invocationContext.topic),t.evt.fire("onSubscribedFailure-"+e.invocationContext.topic,[t])}})},setSubscribed:function(e){this.subscribeArray[e]=1},setUnsubscribed:function(e){this.subscribeArray[e]=0},isSubscribed:function(e){return 1==this.subscribeArray[e]},subscribedThen:function(e,t){this.isSubscribed(e)?t(this):this.evt.addHandler("onSubscribed-"+e,t)},unsubscribe:function(e){this.isSubscribed(e)&&(this.client.unsubscribe(e),this.setUnsubscribed(e))},clearRetainedMsg:function(e){this.publish(e,"",{retained:!0})},decodePayload:function(e,r,n){try{var o,a,f=this.getEssentialConfig("protobuf.headerLength"),h="object"==typeof e?e.COMMAND_ID:e,l=this.getEssentialConfig("protobuf.decodeClassMap");o=void 0===l[h]?s.BaseResponse:l[h],this.logger.debug("The cmdID is ",h),void 0!==n&&(o=n.options||o,f=n.removeHeaderLength||f,h=n.cmdID||h,a=n.isAES||!1);var u=r;f&&(u=r.slice(f));var c;if(i.debug("payloadBytesBody",u),a===!0){var d=t.intArray2HexStr(u);i.debug("payloadHexString",d);var p=CryptoJS.enc.Base64.stringify(CryptoJS.enc.Hex.parse(d)),g=this.getEssentialConfig("AES"),E=t.AESDecrypt(p,g.key,g.iv);i.debug("AESDecrypted Data",t.hex2IntArray(CryptoJS.enc.Hex.stringify(E))),c=o.decodeHex(E.toString())}else c=o.decode(u);return i.debug("Proto Data",c),c}catch(e){i.warning("protobuf decode error",arguments)}return!1},assembleHeader:function(e,t,i,r){var n=this.getEssentialConfig("protobuf.headerStruct"),s=this.getEssentialConfig("protobuf.headerData"),o=[s.MAGIC_NUMBER,s.VERSION,t,i,r],a=new Uint8Array(e),f=0,h=0;for(var l in n){for(var u=n[l];u--;)a[f++]=o[h]>>8*u&255;h++}return a},analyzeHeader:function(e){var t=this.getEssentialConfig("protobuf.headerStruct"),i=this.getEssentialConfig("protobuf.headerData"),r=new Uint8Array(e),n=0;for(var s in t)n+=t[s];if(r.length>=n){var o=r.slice(0,n);if(o[0]==i.MAGIC_NUMBER){var a={},f=0;for(var s in t){a[s]=0;for(var h=t[s];h--;)a[s]|=o[f++]<<8*h}return a}}return!1},protoDataPackage:function(e,t,r){if(e&&!(e instanceof ArrayBuffer)&&!(e instanceof Array)){if(void 0==e.encode||"function"!=typeof e.encode)throw this.logger.error("Data Type Error",e),Error("Data Type Error");e=e.encode().toArrayBuffer()}i.debug("protoDataArrayBuffer",e);var n=new Uint8Array(e);i.debug("payload Bytes",n);var s=n.length,o=n.byteLength,a=this.getEssentialConfig("protobuf.headerLength"),f=new Uint8Array(s+a);f.set(n,a),i.debug("protoDataPackage len",o+a);var h=this.assembleHeader(a,o,t,r);return i.debug("header",h),f.set(h,0),f},protoDataPackageWithAES:function(e,i,r){var n=CryptoJS.enc.Hex.parse(e.encodeHex()),s=this.getEssentialConfig("AES"),o=t.AESEncrypt(n,s.key,s.iv),a=CryptoJS.enc.Base64.parse(o.toString()),f=CryptoJS.enc.Hex.stringify(a),h=t.hex2IntArray(f),l=new Uint8Array(h).buffer;return this.protoDataPackage(l,i,r)},sendCmd2Dev:function(e,r,n,s){var o=t.getSequence();this.logger.debug("sendCmd2Dev Seq",o);var a=this.protoDataPackage(n,r,o);return i.info("sendCmd2Dev Header",this.analyzeHeader(a)),this.publish("/"+e,a),o},sendCmdResp:function(e,t,r,n){var s=this.protoDataPackage(r,t,e);return i.info("sendCmdResp Header",this.analyzeHeader(s)),this.publish("/"+this.getEssentialConfig("accessKey")+"/resp",s,n),!0}};return a}),require(["SDK"],function(e){return e}),define("../build/Dev-SDK-compress",function(){});